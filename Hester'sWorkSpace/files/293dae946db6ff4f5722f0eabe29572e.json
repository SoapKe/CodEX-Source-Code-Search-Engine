{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nfrom odoo import http\nfrom odoo.http import request\n\nfrom odoo.addons.portal.controllers.mail import PortalChatter\n\n\nclass WebsiteRating(PortalChatter):\n\n    @http.route()\n    def portal_chatter_init(self, res_model, res_id, domain=False, limit=False, **kwargs):\n        result = super(WebsiteRating, self).portal_chatter_init(res_model, res_id, domain=domain, limit=limit, **kwargs)\n        \n        if kwargs.get('rating_include'):\n            record = request.env[res_model].browse(res_id)\n            if hasattr(record, 'rating_get_stats'):\n                result['rating_stats'] = record.rating_get_stats([('website_published', '=', True)])\n        return result\n\n    @http.route()\n    def portal_message_fetch(self, res_model, res_id, domain=False, limit=False, offset=False, **kw):\n        \n        if kw.get('rating_include'):\n            context = dict(request.context)\n            context['rating_include'] = True\n            request.context = context\n        return super(WebsiteRating, self).portal_message_fetch(res_model, res_id, domain=domain, limit=limit, offset=offset, **kw)\n", "comments": "      coding  utf 8        part odoo  see license file full copyright licensing details     get rating statistics record    add  rating include  context  fetch portal message format ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nfrom odoo import http\nfrom odoo.http import request\n\nfrom odoo.addons.portal.controllers.mail import PortalChatter\n\n\nclass WebsiteRating(PortalChatter):\n\n    @http.route()\n    def portal_chatter_init(self, res_model, res_id, domain=False, limit=False, **kwargs):\n        result = super(WebsiteRating, self).portal_chatter_init(res_model, res_id, domain=domain, limit=limit, **kwargs)\n        # get the rating statistics about the record\n        if kwargs.get('rating_include'):\n            record = request.env[res_model].browse(res_id)\n            if hasattr(record, 'rating_get_stats'):\n                result['rating_stats'] = record.rating_get_stats([('website_published', '=', True)])\n        return result\n\n    @http.route()\n    def portal_message_fetch(self, res_model, res_id, domain=False, limit=False, offset=False, **kw):\n        # add 'rating_include' in context, to fetch them in portal_message_format\n        if kw.get('rating_include'):\n            context = dict(request.context)\n            context['rating_include'] = True\n            request.context = context\n        return super(WebsiteRating, self).portal_message_fetch(res_model, res_id, domain=domain, limit=limit, offset=offset, **kw)\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "website_mail.py", "id": "293dae946db6ff4f5722f0eabe29572e", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/website_rating/controllers/website_mail.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}