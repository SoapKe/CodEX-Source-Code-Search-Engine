{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nfrom odoo import api, fields, models\n\n\nclass TimesheetAttendance(models.Model):\n    _name = 'hr.timesheet.attendance.report'\n    _auto = False\n\n    user_id = fields.Many2one('res.users')\n    date = fields.Date()\n    total_timesheet = fields.Float()\n    total_attendance = fields.Float()\n    total_difference = fields.Float()\n\n    @api.model_cr\n    def init(self):\n        self._cr.execute(\"\"\"CREATE OR REPLACE VIEW %s AS (\n            SELECT\n                max(id) AS id,\n                t.user_id,\n                t.date,\n                coalesce(sum(t.attendance), 0) AS total_attendance,\n                coalesce(sum(t.timesheet), 0) AS total_timesheet,\n                coalesce(sum(t.attendance), 0) - coalesce(sum(t.timesheet), 0) as total_difference\n            FROM (\n                SELECT\n                    -hr_attendance.id AS id,\n                    resource_resource.user_id AS user_id,\n                    hr_attendance.worked_hours AS attendance,\n                    NULL AS timesheet,\n                    date_trunc('day', hr_attendance.check_in) AS date\n                FROM hr_attendance\n                LEFT JOIN hr_employee ON hr_employee.id = hr_attendance.employee_id\n                LEFT JOIN resource_resource on resource_resource.id = hr_employee.resource_id\n            UNION ALL\n                SELECT\n                    ts.id AS id,\n                    ts.user_id AS user_id,\n                    NULL AS attendance,\n                    ts.unit_amount AS timesheet,\n                    date_trunc('day', ts.date) AS date\n                FROM account_analytic_line AS ts\n                WHERE ts.project_id IS NOT NULL\n            ) AS t\n            GROUP BY t.user_id, t.date\n            ORDER BY t.date\n        )\n        \"\"\" % self._table)\n", "comments": "   create or replace view  as (             select                 max(id) as id                  user id                  date                  coalesce(sum(t attendance)  0) as total attendance                  coalesce(sum(t timesheet)  0) as total timesheet                  coalesce(sum(t attendance)  0)   coalesce(sum(t timesheet)  0) total difference             from (                 select                      hr attendance id as id                      resource resource user id as user id                      hr attendance worked hours as attendance                      null as timesheet                      date trunc( day   hr attendance check in) as date                 from hr attendance                 left join hr employee on hr employee id   hr attendance employee id                 left join resource resource resource resource id   hr employee resource id             union all                 select                     ts id as id                      ts user id as user id                      null as attendance                      ts unit amount as timesheet                      date trunc( day   ts date) as date                 from account analytic line as ts                 where ts project id is not null             ) as             group by user id  date             order by date         )                    coding  utf 8        part odoo  see license file full copyright licensing details  ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nfrom odoo import api, fields, models\n\n\nclass TimesheetAttendance(models.Model):\n    _name = 'hr.timesheet.attendance.report'\n    _auto = False\n\n    user_id = fields.Many2one('res.users')\n    date = fields.Date()\n    total_timesheet = fields.Float()\n    total_attendance = fields.Float()\n    total_difference = fields.Float()\n\n    @api.model_cr\n    def init(self):\n        self._cr.execute(\"\"\"CREATE OR REPLACE VIEW %s AS (\n            SELECT\n                max(id) AS id,\n                t.user_id,\n                t.date,\n                coalesce(sum(t.attendance), 0) AS total_attendance,\n                coalesce(sum(t.timesheet), 0) AS total_timesheet,\n                coalesce(sum(t.attendance), 0) - coalesce(sum(t.timesheet), 0) as total_difference\n            FROM (\n                SELECT\n                    -hr_attendance.id AS id,\n                    resource_resource.user_id AS user_id,\n                    hr_attendance.worked_hours AS attendance,\n                    NULL AS timesheet,\n                    date_trunc('day', hr_attendance.check_in) AS date\n                FROM hr_attendance\n                LEFT JOIN hr_employee ON hr_employee.id = hr_attendance.employee_id\n                LEFT JOIN resource_resource on resource_resource.id = hr_employee.resource_id\n            UNION ALL\n                SELECT\n                    ts.id AS id,\n                    ts.user_id AS user_id,\n                    NULL AS attendance,\n                    ts.unit_amount AS timesheet,\n                    date_trunc('day', ts.date) AS date\n                FROM account_analytic_line AS ts\n                WHERE ts.project_id IS NOT NULL\n            ) AS t\n            GROUP BY t.user_id, t.date\n            ORDER BY t.date\n        )\n        \"\"\" % self._table)\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "hr_timesheet_attendance_report.py", "id": "14c8552fa0902776c1aae2f7225cfeff", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/hr_timesheet_attendance/report/hr_timesheet_attendance_report.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}