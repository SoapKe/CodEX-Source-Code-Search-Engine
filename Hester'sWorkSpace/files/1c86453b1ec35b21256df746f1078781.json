{"author": "ansible", "code": "\nimport gc\nimport os\n\ntry:\n    import coverage\nexcept ImportError:\n    coverage = None\n\ntry:\n    test = coverage.Coverage\nexcept AttributeError:\n    coverage = None\n\n\ndef pytest_configure():\n    if not coverage:\n        return\n\n    coverage_instances = []\n\n    for obj in gc.get_objects():\n        if isinstance(obj, coverage.Coverage):\n            coverage_instances.append(obj)\n\n    if not coverage_instances:\n        return\n\n    os_exit = os._exit\n\n    def coverage_exit(*args, **kwargs):\n        for instance in coverage_instances:\n            instance.stop()\n            instance.save()\n\n        os_exit(*args, **kwargs)\n\n    os._exit = coverage_exit\n", "comments": "   monkey patch os  exit running coverage lose coverage data forks   pytest   boxed      ", "content": "\"\"\"Monkey patch os._exit when running under coverage so we don't lose coverage data in forks, such as with `pytest --boxed`.\"\"\"\nimport gc\nimport os\n\ntry:\n    import coverage\nexcept ImportError:\n    coverage = None\n\ntry:\n    test = coverage.Coverage\nexcept AttributeError:\n    coverage = None\n\n\ndef pytest_configure():\n    if not coverage:\n        return\n\n    coverage_instances = []\n\n    for obj in gc.get_objects():\n        if isinstance(obj, coverage.Coverage):\n            coverage_instances.append(obj)\n\n    if not coverage_instances:\n        return\n\n    os_exit = os._exit\n\n    def coverage_exit(*args, **kwargs):\n        for instance in coverage_instances:\n            instance.stop()\n            instance.save()\n\n        os_exit(*args, **kwargs)\n\n    os._exit = coverage_exit\n", "description": "Ansible is a radically simple IT automation platform that makes your applications and systems easier to deploy. Avoid writing scripts or custom code to deploy and update your applications\u2014 automate in a language that approaches plain English, using SSH, with no agents to install on remote systems.", "file_name": "conftest.py", "id": "1c86453b1ec35b21256df746f1078781", "language": "Python", "project_name": "ansible", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/ansible-ansible/ansible-ansible-d30554b/test/units/conftest.py", "save_time": "", "source": "", "update_at": "2018-03-18T14:08:28Z", "url": "https://github.com/ansible/ansible", "wiki": false}