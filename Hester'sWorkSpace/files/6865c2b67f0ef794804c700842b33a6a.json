{"author": "ansible", "code": "\n# -*- coding: utf-8 -*-\n\n# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)\n\nfrom __future__ import absolute_import, division, print_function\n__metaclass__ = type\n\nANSIBLE_METADATA = {'metadata_version': '1.1',\n                    'status': ['preview'],\n                    'supported_by': 'community'}\n\nDOCUMENTATION = r'''\n---\nmodule: aci_interface_policy_l2\nshort_description: Manage Layer 2 interface policies (l2:IfPol)\ndescription:\n- Manage Layer 2 interface policies on Cisco ACI fabrics.\nauthor:\n- Dag Wieers (@dagwieers)\nversion_added: '2.4'\nnotes:\n- More information about the internal APIC class B(l2:IfPol) from\n  L(the APIC Management Information Model reference,https://developer.cisco.com/docs/apic-mim-ref/).\noptions:\n  l2_policy:\n    description:\n    - The name of the Layer 2 interface policy.\n    required: yes\n    aliases: [ name ]\n  description:\n    description:\n    - The description of the Layer 2 interface policy.\n    aliases: [ descr ]\n  qinq:\n    description:\n    - Determines if QinQ is disabled or if the port should be considered a core or edge port.\n    choices: [ core, disabled, edge ]\n    default: disabled\n  vepa:\n    description:\n    - Determines if Virtual Ethernet Port Aggregator is disabled or enabled.\n    choices: [ disabled, enabled ]\n    default: disabled\n  vlan_scope:\n    description:\n    - The scope of the VLAN.\n    choices: [ global, portlocal ]\n    default: global\n  state:\n    description:\n    - Use C(present) or C(absent) for adding or removing.\n    - Use C(query) for listing an object or multiple objects.\n    choices: [ absent, present, query ]\n    default: present\nextends_documentation_fragment: aci\n'''\n\nEXAMPLES = r'''\n- aci_interface_policy_l2:\n    host: '{{ hostname }}'\n    username: '{{ username }}'\n    password: '{{ password }}'\n    l2_policy: '{{ l2_policy }}'\n    vlan_scope: '{{ vlan_policy }}'\n    description: '{{ description }}'\n'''\n\nRETURN = r'''\ncurrent:\n  description: The existing configuration from the APIC after the module has finished\n  returned: success\n  type: list\n  sample:\n    [\n        {\n            \"fvTenant\": {\n                \"attributes\": {\n                    \"descr\": \"Production environment\",\n                    \"dn\": \"uni/tn-production\",\n                    \"name\": \"production\",\n                    \"nameAlias\": \"\",\n                    \"ownerKey\": \"\",\n                    \"ownerTag\": \"\"\n                }\n            }\n        }\n    ]\nerror:\n  description: The error information as returned from the APIC\n  returned: failure\n  type: dict\n  sample:\n    {\n        \"code\": \"122\",\n        \"text\": \"unknown managed object class foo\"\n    }\nraw:\n  description: The raw output returned by the APIC REST API (xml or json)\n  returned: parse error\n  type: string\n  sample: '<?xml version=\"1.0\" encoding=\"UTF-8\"?><imdata totalCount=\"1\"><error code=\"122\" text=\"unknown managed object class foo\"/></imdata>'\nsent:\n  description: The actual/minimal configuration pushed to the APIC\n  returned: info\n  type: list\n  sample:\n    {\n        \"fvTenant\": {\n            \"attributes\": {\n                \"descr\": \"Production environment\"\n            }\n        }\n    }\nprevious:\n  description: The original configuration from the APIC before the module has started\n  returned: info\n  type: list\n  sample:\n    [\n        {\n            \"fvTenant\": {\n                \"attributes\": {\n                    \"descr\": \"Production\",\n                    \"dn\": \"uni/tn-production\",\n                    \"name\": \"production\",\n                    \"nameAlias\": \"\",\n                    \"ownerKey\": \"\",\n                    \"ownerTag\": \"\"\n                }\n            }\n        }\n    ]\nproposed:\n  description: The assembled configuration from the user-provided parameters\n  returned: info\n  type: dict\n  sample:\n    {\n        \"fvTenant\": {\n            \"attributes\": {\n                \"descr\": \"Production environment\",\n                \"name\": \"production\"\n            }\n        }\n    }\nfilter_string:\n  description: The filter string used for the request\n  returned: failure or debug\n  type: string\n  sample: ?rsp-prop-include=config-only\nmethod:\n  description: The HTTP method used for the request to the APIC\n  returned: failure or debug\n  type: string\n  sample: POST\nresponse:\n  description: The HTTP response from the APIC\n  returned: failure or debug\n  type: string\n  sample: OK (30 bytes)\nstatus:\n  description: The HTTP status from the APIC\n  returned: failure or debug\n  type: int\n  sample: 200\nurl:\n  description: The HTTP url used for the request to the APIC\n  returned: failure or debug\n  type: string\n  sample: https://10.11.12.13/api/mo/uni/tn-production.json\n'''\n\nfrom ansible.module_utils.network.aci.aci import ACIModule, aci_argument_spec\nfrom ansible.module_utils.basic import AnsibleModule\n\n\nQINQ_MAPPING = dict(core='corePort', disabled='disabled', edge='edgePort')\n\n\ndef main():\n    argument_spec = aci_argument_spec()\n    argument_spec.update(\n        l2_policy=dict(type='str', required=False, aliases=['name']),  \n        description=dict(type='str', aliases=['descr']),\n        vlan_scope=dict(type='str', choices=['global', 'portlocal']),  \n        qinq=dict(type='str', choices=['core', 'disabled', 'edge']),\n        vepa=dict(type='raw'),  \n        state=dict(type='str', default='present', choices=['absent', 'present', 'query']),\n        method=dict(type='str', choices=['delete', 'get', 'post'], aliases=['action'], removed_in_version='2.6'),  \n        protocol=dict(type='str', removed_in_version='2.6'),  \n    )\n\n    module = AnsibleModule(\n        argument_spec=argument_spec,\n        supports_check_mode=True,\n        required_if=[\n            ['state', 'absent', ['l2_policy']],\n            ['state', 'present', ['l2_policy']],\n        ],\n    )\n\n    aci = ACIModule(module)\n\n    l2_policy = module.params['l2_policy']\n    vlan_scope = module.params['vlan_scope']\n    qinq = module.params['qinq']\n    if qinq is not None:\n        qinq = QINQ_MAPPING[qinq]\n    vepa = aci.boolean(module.params['vepa'], 'enabled', 'disabled')\n    description = module.params['description']\n    state = module.params['state']\n\n    aci.construct_url(\n        root_class=dict(\n            aci_class='l2IfPol',\n            aci_rn='infra/l2IfP-{0}'.format(l2_policy),\n            filter_target='eq(l2IfPol.name, \"{0}\")'.format(l2_policy),\n            module_object=l2_policy,\n        ),\n    )\n\n    aci.get_existing()\n\n    if state == 'present':\n        aci.payload(\n            aci_class='l2IfPol',\n            class_config=dict(\n                name=l2_policy,\n                descr=description,\n                vlanScope=vlan_scope,\n                qinq=qinq, vepa=vepa,\n            ),\n        )\n\n        aci.get_diff(aci_class='l2IfPol')\n\n        aci.post_config()\n\n    elif state == 'absent':\n        aci.delete_config()\n\n    aci.exit_json()\n\n\nif __name__ == \"__main__\":\n    main()\n", "comments": "        module  aci interface policy l2 short description  manage layer 2 interface policies (l2 ifpol) description    manage layer 2 interface policies cisco aci fabrics  author    dag wieers ( dagwieers) version added   2 4  notes    more information internal apic class b(l2 ifpol)   l(the apic management information model reference https   developer cisco com docs apic mim ref )  options    l2 policy      description        the name layer 2 interface policy      required  yes     aliases    name     description      description        the description layer 2 interface policy      aliases    descr     qinq      description        determines qinq disabled port considered core edge port      choices    core  disabled  edge       default  disabled   vepa      description        determines virtual ethernet port aggregator disabled enabled      choices    disabled  enabled       default  disabled   vlan scope      description        the scope vlan      choices    global  portlocal       default  global   state      description        use c(present) c(absent) adding removing        use c(query) listing object multiple objects      choices    absent  present  query       default  present extends documentation fragment  aci      examples   r      aci interface policy l2      host      hostname         username      username         password      password         l2 policy      l2 policy         vlan scope      vlan policy         description      description          return   r    current    description  the existing configuration apic module finished   returned  success   type  list   sample                               fvtenant                      attributes                          descr    production environment                        dn    uni tn production                        name    production                        namealias                            ownerkey                            ownertag                                                      error    description  the error information returned apic   returned  failure   type  dict   sample                 code    122            text    unknown managed object class foo        raw    description  the raw output returned apic rest api (xml json)   returned  parse error   type  string   sample     xml version  1 0  encoding  utf 8    imdata totalcount  1   error code  122  text  unknown managed object class foo     imdata   sent    description  the actual minimal configuration pushed apic   returned  info   type  list   sample                 fvtenant                  attributes                      descr    production environment                                previous    description  the original configuration apic module started   returned  info   type  list   sample                               fvtenant                      attributes                          descr    production                        dn    uni tn production                        name    production                        namealias                            ownerkey                            ownertag                                                      proposed    description  the assembled configuration user provided parameters   returned  info   type  dict   sample                 fvtenant                  attributes                      descr    production environment                    name    production                                filter string    description  the filter string used request   returned  failure debug   type  string   sample   rsp prop include config method    description  the http method used request apic   returned  failure debug   type  string   sample  post response    description  the http response apic   returned  failure debug   type  string   sample  ok (30 bytes) status    description  the http status apic   returned  failure debug   type  int   sample  200 url    description  the http url used request apic   returned  failure debug   type  string   sample  https   10 11 12 13 api mo uni tn production json         usr bin python        coding  utf 8        gnu general public license v3 0  (see copying https   www gnu org licenses gpl 3 0 txt)    mapping dicts used normalize proposed data apic expects  keep diffs accurate    not required querying policies    no default provided purpose    turn boolean v2 9    deprecated starting v2 6    deprecated v2 6 ", "content": "#!/usr/bin/python\n# -*- coding: utf-8 -*-\n\n# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)\n\nfrom __future__ import absolute_import, division, print_function\n__metaclass__ = type\n\nANSIBLE_METADATA = {'metadata_version': '1.1',\n                    'status': ['preview'],\n                    'supported_by': 'community'}\n\nDOCUMENTATION = r'''\n---\nmodule: aci_interface_policy_l2\nshort_description: Manage Layer 2 interface policies (l2:IfPol)\ndescription:\n- Manage Layer 2 interface policies on Cisco ACI fabrics.\nauthor:\n- Dag Wieers (@dagwieers)\nversion_added: '2.4'\nnotes:\n- More information about the internal APIC class B(l2:IfPol) from\n  L(the APIC Management Information Model reference,https://developer.cisco.com/docs/apic-mim-ref/).\noptions:\n  l2_policy:\n    description:\n    - The name of the Layer 2 interface policy.\n    required: yes\n    aliases: [ name ]\n  description:\n    description:\n    - The description of the Layer 2 interface policy.\n    aliases: [ descr ]\n  qinq:\n    description:\n    - Determines if QinQ is disabled or if the port should be considered a core or edge port.\n    choices: [ core, disabled, edge ]\n    default: disabled\n  vepa:\n    description:\n    - Determines if Virtual Ethernet Port Aggregator is disabled or enabled.\n    choices: [ disabled, enabled ]\n    default: disabled\n  vlan_scope:\n    description:\n    - The scope of the VLAN.\n    choices: [ global, portlocal ]\n    default: global\n  state:\n    description:\n    - Use C(present) or C(absent) for adding or removing.\n    - Use C(query) for listing an object or multiple objects.\n    choices: [ absent, present, query ]\n    default: present\nextends_documentation_fragment: aci\n'''\n\nEXAMPLES = r'''\n- aci_interface_policy_l2:\n    host: '{{ hostname }}'\n    username: '{{ username }}'\n    password: '{{ password }}'\n    l2_policy: '{{ l2_policy }}'\n    vlan_scope: '{{ vlan_policy }}'\n    description: '{{ description }}'\n'''\n\nRETURN = r'''\ncurrent:\n  description: The existing configuration from the APIC after the module has finished\n  returned: success\n  type: list\n  sample:\n    [\n        {\n            \"fvTenant\": {\n                \"attributes\": {\n                    \"descr\": \"Production environment\",\n                    \"dn\": \"uni/tn-production\",\n                    \"name\": \"production\",\n                    \"nameAlias\": \"\",\n                    \"ownerKey\": \"\",\n                    \"ownerTag\": \"\"\n                }\n            }\n        }\n    ]\nerror:\n  description: The error information as returned from the APIC\n  returned: failure\n  type: dict\n  sample:\n    {\n        \"code\": \"122\",\n        \"text\": \"unknown managed object class foo\"\n    }\nraw:\n  description: The raw output returned by the APIC REST API (xml or json)\n  returned: parse error\n  type: string\n  sample: '<?xml version=\"1.0\" encoding=\"UTF-8\"?><imdata totalCount=\"1\"><error code=\"122\" text=\"unknown managed object class foo\"/></imdata>'\nsent:\n  description: The actual/minimal configuration pushed to the APIC\n  returned: info\n  type: list\n  sample:\n    {\n        \"fvTenant\": {\n            \"attributes\": {\n                \"descr\": \"Production environment\"\n            }\n        }\n    }\nprevious:\n  description: The original configuration from the APIC before the module has started\n  returned: info\n  type: list\n  sample:\n    [\n        {\n            \"fvTenant\": {\n                \"attributes\": {\n                    \"descr\": \"Production\",\n                    \"dn\": \"uni/tn-production\",\n                    \"name\": \"production\",\n                    \"nameAlias\": \"\",\n                    \"ownerKey\": \"\",\n                    \"ownerTag\": \"\"\n                }\n            }\n        }\n    ]\nproposed:\n  description: The assembled configuration from the user-provided parameters\n  returned: info\n  type: dict\n  sample:\n    {\n        \"fvTenant\": {\n            \"attributes\": {\n                \"descr\": \"Production environment\",\n                \"name\": \"production\"\n            }\n        }\n    }\nfilter_string:\n  description: The filter string used for the request\n  returned: failure or debug\n  type: string\n  sample: ?rsp-prop-include=config-only\nmethod:\n  description: The HTTP method used for the request to the APIC\n  returned: failure or debug\n  type: string\n  sample: POST\nresponse:\n  description: The HTTP response from the APIC\n  returned: failure or debug\n  type: string\n  sample: OK (30 bytes)\nstatus:\n  description: The HTTP status from the APIC\n  returned: failure or debug\n  type: int\n  sample: 200\nurl:\n  description: The HTTP url used for the request to the APIC\n  returned: failure or debug\n  type: string\n  sample: https://10.11.12.13/api/mo/uni/tn-production.json\n'''\n\nfrom ansible.module_utils.network.aci.aci import ACIModule, aci_argument_spec\nfrom ansible.module_utils.basic import AnsibleModule\n\n# Mapping dicts are used to normalize the proposed data to what the APIC expects, which will keep diffs accurate\nQINQ_MAPPING = dict(core='corePort', disabled='disabled', edge='edgePort')\n\n\ndef main():\n    argument_spec = aci_argument_spec()\n    argument_spec.update(\n        l2_policy=dict(type='str', required=False, aliases=['name']),  # Not required for querying all policies\n        description=dict(type='str', aliases=['descr']),\n        vlan_scope=dict(type='str', choices=['global', 'portlocal']),  # No default provided on purpose\n        qinq=dict(type='str', choices=['core', 'disabled', 'edge']),\n        vepa=dict(type='raw'),  # Turn into a boolean in v2.9\n        state=dict(type='str', default='present', choices=['absent', 'present', 'query']),\n        method=dict(type='str', choices=['delete', 'get', 'post'], aliases=['action'], removed_in_version='2.6'),  # Deprecated starting from v2.6\n        protocol=dict(type='str', removed_in_version='2.6'),  # Deprecated in v2.6\n    )\n\n    module = AnsibleModule(\n        argument_spec=argument_spec,\n        supports_check_mode=True,\n        required_if=[\n            ['state', 'absent', ['l2_policy']],\n            ['state', 'present', ['l2_policy']],\n        ],\n    )\n\n    aci = ACIModule(module)\n\n    l2_policy = module.params['l2_policy']\n    vlan_scope = module.params['vlan_scope']\n    qinq = module.params['qinq']\n    if qinq is not None:\n        qinq = QINQ_MAPPING[qinq]\n    vepa = aci.boolean(module.params['vepa'], 'enabled', 'disabled')\n    description = module.params['description']\n    state = module.params['state']\n\n    aci.construct_url(\n        root_class=dict(\n            aci_class='l2IfPol',\n            aci_rn='infra/l2IfP-{0}'.format(l2_policy),\n            filter_target='eq(l2IfPol.name, \"{0}\")'.format(l2_policy),\n            module_object=l2_policy,\n        ),\n    )\n\n    aci.get_existing()\n\n    if state == 'present':\n        aci.payload(\n            aci_class='l2IfPol',\n            class_config=dict(\n                name=l2_policy,\n                descr=description,\n                vlanScope=vlan_scope,\n                qinq=qinq, vepa=vepa,\n            ),\n        )\n\n        aci.get_diff(aci_class='l2IfPol')\n\n        aci.post_config()\n\n    elif state == 'absent':\n        aci.delete_config()\n\n    aci.exit_json()\n\n\nif __name__ == \"__main__\":\n    main()\n", "description": "Ansible is a radically simple IT automation platform that makes your applications and systems easier to deploy. Avoid writing scripts or custom code to deploy and update your applications\u2014 automate in a language that approaches plain English, using SSH, with no agents to install on remote systems.", "file_name": "_aci_intf_policy_l2.py", "id": "6865c2b67f0ef794804c700842b33a6a", "language": "Python", "project_name": "ansible", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/ansible-ansible/ansible-ansible-d30554b/lib/ansible/modules/network/aci/_aci_intf_policy_l2.py", "save_time": "", "source": "", "update_at": "2018-03-18T14:08:28Z", "url": "https://github.com/ansible/ansible", "wiki": false}