{"author": "rg3", "code": "from __future__ import unicode_literals\n\nimport re\n\nfrom .common import InfoExtractor\nfrom ..compat import compat_urlparse\nfrom ..utils import (\n    parse_duration,\n    parse_iso8601,\n    str_to_int,\n)\n\n\nclass FourTubeBaseIE(InfoExtractor):\n    def _real_extract(self, url):\n        mobj = re.match(self._VALID_URL, url)\n        kind, video_id, display_id = mobj.group('kind', 'id', 'display_id')\n\n        if kind == 'm' or not display_id:\n            url = self._URL_TEMPLATE % video_id\n\n        webpage = self._download_webpage(url, video_id)\n\n        title = self._html_search_meta('name', webpage)\n        timestamp = parse_iso8601(self._html_search_meta(\n            'uploadDate', webpage))\n        thumbnail = self._html_search_meta('thumbnailUrl', webpage)\n        uploader_id = self._html_search_regex(\n            r'<a class=\"item-to-subscribe\" href=\"[^\"]+/(?:channel|user)s?/([^/\"]+)\" title=\"Go to [^\"]+ page\">',\n            webpage, 'uploader id', fatal=False)\n        uploader = self._html_search_regex(\n            r'<a class=\"item-to-subscribe\" href=\"[^\"]+/(?:channel|user)s?/[^/\"]+\" title=\"Go to ([^\"]+) page\">',\n            webpage, 'uploader', fatal=False)\n\n        categories_html = self._search_regex(\n            r'(?s)><i class=\"icon icon-tag\"></i>\\s*Categories / Tags\\s*.*?<ul class=\"[^\"]*?list[^\"]*?\">(.*?)</ul>',\n            webpage, 'categories', fatal=False)\n        categories = None\n        if categories_html:\n            categories = [\n                c.strip() for c in re.findall(\n                    r'(?s)<li><a.*?>(.*?)</a>', categories_html)]\n\n        view_count = str_to_int(self._search_regex(\n            r'<meta[^>]+itemprop=\"interactionCount\"[^>]+content=\"UserPlays:([0-9,]+)\">',\n            webpage, 'view count', default=None))\n        like_count = str_to_int(self._search_regex(\n            r'<meta[^>]+itemprop=\"interactionCount\"[^>]+content=\"UserLikes:([0-9,]+)\">',\n            webpage, 'like count', default=None))\n        duration = parse_duration(self._html_search_meta('duration', webpage))\n\n        media_id = self._search_regex(\n            r'<button[^>]+data-id=([\"\\'])(?P<id>\\d+)\\1[^>]+data-quality=', webpage,\n            'media id', default=None, group='id')\n        sources = [\n            quality\n            for _, quality in re.findall(r'<button[^>]+data-quality=([\"\\'])(.+?)\\1', webpage)]\n        if not (media_id and sources):\n            player_js = self._download_webpage(\n                self._search_regex(\n                    r'<script[^>]id=([\"\\'])playerembed\\1[^>]+src=([\"\\'])(?P<url>.+?)\\2',\n                    webpage, 'player JS', group='url'),\n                video_id, 'Downloading player JS')\n            params_js = self._search_regex(\n                r'\\$\\.ajax\\(url,\\ opts\\);\\s*\\}\\s*\\}\\)\\(([0-9,\\[\\] ]+)\\)',\n                player_js, 'initialization parameters')\n            params = self._parse_json('[%s]' % params_js, video_id)\n            media_id = params[0]\n            sources = ['%s' % p for p in params[2]]\n\n        token_url = 'https://tkn.kodicdn.com/{0}/desktop/{1}'.format(\n            media_id, '+'.join(sources))\n\n        parsed_url = compat_urlparse.urlparse(url)\n        tokens = self._download_json(token_url, video_id, data=b'', headers={\n            'Origin': '%s://%s' % (parsed_url.scheme, parsed_url.hostname),\n            'Referer': url,\n        })\n        formats = [{\n            'url': tokens[format]['token'],\n            'format_id': format + 'p',\n            'resolution': format + 'p',\n            'quality': int(format),\n        } for format in sources]\n        self._sort_formats(formats)\n\n        return {\n            'id': video_id,\n            'title': title,\n            'formats': formats,\n            'categories': categories,\n            'thumbnail': thumbnail,\n            'uploader': uploader,\n            'uploader_id': uploader_id,\n            'timestamp': timestamp,\n            'like_count': like_count,\n            'view_count': view_count,\n            'duration': duration,\n            'age_limit': 18,\n        }\n\n\nclass FourTubeIE(FourTubeBaseIE):\n    IE_NAME = '4tube'\n    _VALID_URL = r'https?://(?:(?P<kind>www|m)\\.)?4tube\\.com/(?:videos|embed)/(?P<id>\\d+)(?:/(?P<display_id>[^/?\n    _URL_TEMPLATE = 'https://www.4tube.com/videos/%s/video'\n    _TESTS = [{\n        'url': 'http://www.4tube.com/videos/209733/hot-babe-holly-michaels-gets-her-ass-stuffed-by-black',\n        'md5': '6516c8ac63b03de06bc8eac14362db4f',\n        'info_dict': {\n            'id': '209733',\n            'ext': 'mp4',\n            'title': 'Hot Babe Holly Michaels gets her ass stuffed by black',\n            'uploader': 'WCP Club',\n            'uploader_id': 'wcp-club',\n            'upload_date': '20131031',\n            'timestamp': 1383263892,\n            'duration': 583,\n            'view_count': int,\n            'like_count': int,\n            'categories': list,\n            'age_limit': 18,\n        },\n    }, {\n        'url': 'http://www.4tube.com/embed/209733',\n        'only_matching': True,\n    }, {\n        'url': 'http://m.4tube.com/videos/209733/hot-babe-holly-michaels-gets-her-ass-stuffed-by-black',\n        'only_matching': True,\n    }]\n\n\nclass FuxIE(FourTubeBaseIE):\n    _VALID_URL = r'https?://(?:(?P<kind>www|m)\\.)?fux\\.com/(?:video|embed)/(?P<id>\\d+)(?:/(?P<display_id>[^/?\n    _URL_TEMPLATE = 'https://www.fux.com/video/%s/video'\n    _TESTS = [{\n        'url': 'https://www.fux.com/video/195359/awesome-fucking-kitchen-ends-cum-swallow',\n        'info_dict': {\n            'id': '195359',\n            'ext': 'mp4',\n            'title': 'Awesome fucking in the kitchen ends with cum swallow',\n            'uploader': 'alenci2342',\n            'uploader_id': 'alenci2342',\n            'upload_date': '20131230',\n            'timestamp': 1388361660,\n            'duration': 289,\n            'view_count': int,\n            'like_count': int,\n            'categories': list,\n            'age_limit': 18,\n        },\n        'params': {\n            'skip_download': True,\n        },\n    }, {\n        'url': 'https://www.fux.com/embed/195359',\n        'only_matching': True,\n    }, {\n        'url': 'https://www.fux.com/video/195359/awesome-fucking-kitchen-ends-cum-swallow',\n        'only_matching': True,\n    }]\n\n\nclass PornTubeIE(FourTubeBaseIE):\n    _VALID_URL = r'https?://(?:(?P<kind>www|m)\\.)?porntube\\.com/(?:videos/(?P<display_id>[^/]+)_|embed/)(?P<id>\\d+)'\n    _URL_TEMPLATE = 'https://www.porntube.com/videos/video_%s'\n    _TESTS = [{\n        'url': 'https://www.porntube.com/videos/teen-couple-doing-anal_7089759',\n        'info_dict': {\n            'id': '7089759',\n            'ext': 'mp4',\n            'title': 'Teen couple doing anal',\n            'uploader': 'Alexy',\n            'uploader_id': 'Alexy',\n            'upload_date': '20150606',\n            'timestamp': 1433595647,\n            'duration': 5052,\n            'view_count': int,\n            'like_count': int,\n            'categories': list,\n            'age_limit': 18,\n        },\n        'params': {\n            'skip_download': True,\n        },\n    }, {\n        'url': 'https://www.porntube.com/embed/7089759',\n        'only_matching': True,\n    }, {\n        'url': 'https://m.porntube.com/videos/teen-couple-doing-anal_7089759',\n        'only_matching': True,\n    }]\n\n\nclass PornerBrosIE(FourTubeBaseIE):\n    _VALID_URL = r'https?://(?:(?P<kind>www|m)\\.)?pornerbros\\.com/(?:videos/(?P<display_id>[^/]+)_|embed/)(?P<id>\\d+)'\n    _URL_TEMPLATE = 'https://www.pornerbros.com/videos/video_%s'\n    _TESTS = [{\n        'url': 'https://www.pornerbros.com/videos/skinny-brunette-takes-big-cock-down-her-anal-hole_181369',\n        'md5': '6516c8ac63b03de06bc8eac14362db4f',\n        'info_dict': {\n            'id': '181369',\n            'ext': 'mp4',\n            'title': 'Skinny brunette takes big cock down her anal hole',\n            'uploader': 'PornerBros HD',\n            'uploader_id': 'pornerbros-hd',\n            'upload_date': '20130130',\n            'timestamp': 1359527401,\n            'duration': 1224,\n            'view_count': int,\n            'categories': list,\n            'age_limit': 18,\n        },\n        'params': {\n            'skip_download': True,\n        },\n    }, {\n        'url': 'https://www.pornerbros.com/embed/181369',\n        'only_matching': True,\n    }, {\n        'url': 'https://m.pornerbros.com/videos/skinny-brunette-takes-big-cock-down-her-anal-hole_181369',\n        'only_matching': True,\n    }]\n", "comments": "#&]+))?'\n#&]+))?'\n", "content": "from __future__ import unicode_literals\n\nimport re\n\nfrom .common import InfoExtractor\nfrom ..compat import compat_urlparse\nfrom ..utils import (\n    parse_duration,\n    parse_iso8601,\n    str_to_int,\n)\n\n\nclass FourTubeBaseIE(InfoExtractor):\n    def _real_extract(self, url):\n        mobj = re.match(self._VALID_URL, url)\n        kind, video_id, display_id = mobj.group('kind', 'id', 'display_id')\n\n        if kind == 'm' or not display_id:\n            url = self._URL_TEMPLATE % video_id\n\n        webpage = self._download_webpage(url, video_id)\n\n        title = self._html_search_meta('name', webpage)\n        timestamp = parse_iso8601(self._html_search_meta(\n            'uploadDate', webpage))\n        thumbnail = self._html_search_meta('thumbnailUrl', webpage)\n        uploader_id = self._html_search_regex(\n            r'<a class=\"item-to-subscribe\" href=\"[^\"]+/(?:channel|user)s?/([^/\"]+)\" title=\"Go to [^\"]+ page\">',\n            webpage, 'uploader id', fatal=False)\n        uploader = self._html_search_regex(\n            r'<a class=\"item-to-subscribe\" href=\"[^\"]+/(?:channel|user)s?/[^/\"]+\" title=\"Go to ([^\"]+) page\">',\n            webpage, 'uploader', fatal=False)\n\n        categories_html = self._search_regex(\n            r'(?s)><i class=\"icon icon-tag\"></i>\\s*Categories / Tags\\s*.*?<ul class=\"[^\"]*?list[^\"]*?\">(.*?)</ul>',\n            webpage, 'categories', fatal=False)\n        categories = None\n        if categories_html:\n            categories = [\n                c.strip() for c in re.findall(\n                    r'(?s)<li><a.*?>(.*?)</a>', categories_html)]\n\n        view_count = str_to_int(self._search_regex(\n            r'<meta[^>]+itemprop=\"interactionCount\"[^>]+content=\"UserPlays:([0-9,]+)\">',\n            webpage, 'view count', default=None))\n        like_count = str_to_int(self._search_regex(\n            r'<meta[^>]+itemprop=\"interactionCount\"[^>]+content=\"UserLikes:([0-9,]+)\">',\n            webpage, 'like count', default=None))\n        duration = parse_duration(self._html_search_meta('duration', webpage))\n\n        media_id = self._search_regex(\n            r'<button[^>]+data-id=([\"\\'])(?P<id>\\d+)\\1[^>]+data-quality=', webpage,\n            'media id', default=None, group='id')\n        sources = [\n            quality\n            for _, quality in re.findall(r'<button[^>]+data-quality=([\"\\'])(.+?)\\1', webpage)]\n        if not (media_id and sources):\n            player_js = self._download_webpage(\n                self._search_regex(\n                    r'<script[^>]id=([\"\\'])playerembed\\1[^>]+src=([\"\\'])(?P<url>.+?)\\2',\n                    webpage, 'player JS', group='url'),\n                video_id, 'Downloading player JS')\n            params_js = self._search_regex(\n                r'\\$\\.ajax\\(url,\\ opts\\);\\s*\\}\\s*\\}\\)\\(([0-9,\\[\\] ]+)\\)',\n                player_js, 'initialization parameters')\n            params = self._parse_json('[%s]' % params_js, video_id)\n            media_id = params[0]\n            sources = ['%s' % p for p in params[2]]\n\n        token_url = 'https://tkn.kodicdn.com/{0}/desktop/{1}'.format(\n            media_id, '+'.join(sources))\n\n        parsed_url = compat_urlparse.urlparse(url)\n        tokens = self._download_json(token_url, video_id, data=b'', headers={\n            'Origin': '%s://%s' % (parsed_url.scheme, parsed_url.hostname),\n            'Referer': url,\n        })\n        formats = [{\n            'url': tokens[format]['token'],\n            'format_id': format + 'p',\n            'resolution': format + 'p',\n            'quality': int(format),\n        } for format in sources]\n        self._sort_formats(formats)\n\n        return {\n            'id': video_id,\n            'title': title,\n            'formats': formats,\n            'categories': categories,\n            'thumbnail': thumbnail,\n            'uploader': uploader,\n            'uploader_id': uploader_id,\n            'timestamp': timestamp,\n            'like_count': like_count,\n            'view_count': view_count,\n            'duration': duration,\n            'age_limit': 18,\n        }\n\n\nclass FourTubeIE(FourTubeBaseIE):\n    IE_NAME = '4tube'\n    _VALID_URL = r'https?://(?:(?P<kind>www|m)\\.)?4tube\\.com/(?:videos|embed)/(?P<id>\\d+)(?:/(?P<display_id>[^/?#&]+))?'\n    _URL_TEMPLATE = 'https://www.4tube.com/videos/%s/video'\n    _TESTS = [{\n        'url': 'http://www.4tube.com/videos/209733/hot-babe-holly-michaels-gets-her-ass-stuffed-by-black',\n        'md5': '6516c8ac63b03de06bc8eac14362db4f',\n        'info_dict': {\n            'id': '209733',\n            'ext': 'mp4',\n            'title': 'Hot Babe Holly Michaels gets her ass stuffed by black',\n            'uploader': 'WCP Club',\n            'uploader_id': 'wcp-club',\n            'upload_date': '20131031',\n            'timestamp': 1383263892,\n            'duration': 583,\n            'view_count': int,\n            'like_count': int,\n            'categories': list,\n            'age_limit': 18,\n        },\n    }, {\n        'url': 'http://www.4tube.com/embed/209733',\n        'only_matching': True,\n    }, {\n        'url': 'http://m.4tube.com/videos/209733/hot-babe-holly-michaels-gets-her-ass-stuffed-by-black',\n        'only_matching': True,\n    }]\n\n\nclass FuxIE(FourTubeBaseIE):\n    _VALID_URL = r'https?://(?:(?P<kind>www|m)\\.)?fux\\.com/(?:video|embed)/(?P<id>\\d+)(?:/(?P<display_id>[^/?#&]+))?'\n    _URL_TEMPLATE = 'https://www.fux.com/video/%s/video'\n    _TESTS = [{\n        'url': 'https://www.fux.com/video/195359/awesome-fucking-kitchen-ends-cum-swallow',\n        'info_dict': {\n            'id': '195359',\n            'ext': 'mp4',\n            'title': 'Awesome fucking in the kitchen ends with cum swallow',\n            'uploader': 'alenci2342',\n            'uploader_id': 'alenci2342',\n            'upload_date': '20131230',\n            'timestamp': 1388361660,\n            'duration': 289,\n            'view_count': int,\n            'like_count': int,\n            'categories': list,\n            'age_limit': 18,\n        },\n        'params': {\n            'skip_download': True,\n        },\n    }, {\n        'url': 'https://www.fux.com/embed/195359',\n        'only_matching': True,\n    }, {\n        'url': 'https://www.fux.com/video/195359/awesome-fucking-kitchen-ends-cum-swallow',\n        'only_matching': True,\n    }]\n\n\nclass PornTubeIE(FourTubeBaseIE):\n    _VALID_URL = r'https?://(?:(?P<kind>www|m)\\.)?porntube\\.com/(?:videos/(?P<display_id>[^/]+)_|embed/)(?P<id>\\d+)'\n    _URL_TEMPLATE = 'https://www.porntube.com/videos/video_%s'\n    _TESTS = [{\n        'url': 'https://www.porntube.com/videos/teen-couple-doing-anal_7089759',\n        'info_dict': {\n            'id': '7089759',\n            'ext': 'mp4',\n            'title': 'Teen couple doing anal',\n            'uploader': 'Alexy',\n            'uploader_id': 'Alexy',\n            'upload_date': '20150606',\n            'timestamp': 1433595647,\n            'duration': 5052,\n            'view_count': int,\n            'like_count': int,\n            'categories': list,\n            'age_limit': 18,\n        },\n        'params': {\n            'skip_download': True,\n        },\n    }, {\n        'url': 'https://www.porntube.com/embed/7089759',\n        'only_matching': True,\n    }, {\n        'url': 'https://m.porntube.com/videos/teen-couple-doing-anal_7089759',\n        'only_matching': True,\n    }]\n\n\nclass PornerBrosIE(FourTubeBaseIE):\n    _VALID_URL = r'https?://(?:(?P<kind>www|m)\\.)?pornerbros\\.com/(?:videos/(?P<display_id>[^/]+)_|embed/)(?P<id>\\d+)'\n    _URL_TEMPLATE = 'https://www.pornerbros.com/videos/video_%s'\n    _TESTS = [{\n        'url': 'https://www.pornerbros.com/videos/skinny-brunette-takes-big-cock-down-her-anal-hole_181369',\n        'md5': '6516c8ac63b03de06bc8eac14362db4f',\n        'info_dict': {\n            'id': '181369',\n            'ext': 'mp4',\n            'title': 'Skinny brunette takes big cock down her anal hole',\n            'uploader': 'PornerBros HD',\n            'uploader_id': 'pornerbros-hd',\n            'upload_date': '20130130',\n            'timestamp': 1359527401,\n            'duration': 1224,\n            'view_count': int,\n            'categories': list,\n            'age_limit': 18,\n        },\n        'params': {\n            'skip_download': True,\n        },\n    }, {\n        'url': 'https://www.pornerbros.com/embed/181369',\n        'only_matching': True,\n    }, {\n        'url': 'https://m.pornerbros.com/videos/skinny-brunette-takes-big-cock-down-her-anal-hole_181369',\n        'only_matching': True,\n    }]\n", "description": "Command-line program to download videos from YouTube.com and other video sites", "file_name": "fourtube.py", "language": "Python", "project_name": "youtube-dl", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/rg3_youtube-dl/rg3-youtube-dl-6202f08/youtube_dl/extractor/fourtube.py", "save_time": "", "source": "", "update_at": "2018-03-07T09:18:39Z", "url": "https://github.com/rg3/youtube-dl", "wiki": false}