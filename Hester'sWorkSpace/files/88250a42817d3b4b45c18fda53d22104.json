{"author": "getredash", "code": "from redash.models import db\n\nif __name__ == '__main__':\n    db.connect_db()\n\n    with db.database.transaction():\n        \n        db.database.execute_sql(\"\"\"\n        UPDATE data_sources\n        SET name = new_names.name\n        FROM (\n            SELECT id, name || ' ' || id as name\n            FROM (SELECT id, name, rank() OVER (PARTITION BY name ORDER BY created_at ASC) FROM data_sources) ds WHERE rank > 1\n        ) AS new_names\n        WHERE data_sources.id = new_names.id;\n        \"\"\")\n        \n        db.database.execute_sql(\"ALTER TABLE data_sources ADD CONSTRAINT unique_name UNIQUE (name);\")\n\n    db.close_db(None)\n", "comments": "            update data sources         set name   new names name         from (             select id  name           id name             from (select id  name  rank() over (partition by name order by created asc) from data sources) ds where rank   1         ) as new names         where data sources id   new names id                 make sure data sources names unique     add unique constraint data sources name  ", "content": "from redash.models import db\n\nif __name__ == '__main__':\n    db.connect_db()\n\n    with db.database.transaction():\n        # Make sure all data sources names are unique.\n        db.database.execute_sql(\"\"\"\n        UPDATE data_sources\n        SET name = new_names.name\n        FROM (\n            SELECT id, name || ' ' || id as name\n            FROM (SELECT id, name, rank() OVER (PARTITION BY name ORDER BY created_at ASC) FROM data_sources) ds WHERE rank > 1\n        ) AS new_names\n        WHERE data_sources.id = new_names.id;\n        \"\"\")\n        # Add unique constraint on data_sources.name.\n        db.database.execute_sql(\"ALTER TABLE data_sources ADD CONSTRAINT unique_name UNIQUE (name);\")\n\n    db.close_db(None)\n", "description": "Make Your Company Data Driven. Connect to any data source, easily visualize and share your data.", "file_name": "0008_make_ds_name_unique.py", "id": "88250a42817d3b4b45c18fda53d22104", "language": "Python", "project_name": "redash", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/getredash-redash/getredash-redash-0410d83/old_migrations/0008_make_ds_name_unique.py", "save_time": "", "source": "", "update_at": "2018-03-18T12:54:55Z", "url": "https://github.com/getredash/redash", "wiki": false}