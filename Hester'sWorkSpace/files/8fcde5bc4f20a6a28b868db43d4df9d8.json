{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nimport re\nimport odoo.tests\n\nRE_ONLY = re.compile('QUnit\\.only\\(')\n\nclass WebSuite(odoo.tests.HttpCase):\n\n    post_install = True\n    at_install = False\n\n    def test_01_js(self):\n        \n        self.phantom_js('/web/tests?mod=web', \"\", \"\", login='admin', timeout=360)\n\n    def test_02_js(self):\n        \n        self.phantom_js('/web/tests/mobile?mod=web', \"\", \"\", login='admin', timeout=300)\n\n    def test_check_suite(self):\n        \n        self._check_only_call('web.qunit_suite')\n        self._check_only_call('web.qunit_mobile_suite')\n\n    def _check_only_call(self, suite):\n        \n        \n        self.env.ref('web.layout').write({'arch_db': '<t t-name=\"web.layout\"><t t-raw=\"head\"/></t>'})\n\n        for asset in self.env['ir.qweb']._get_asset_content(suite, options={})[0]:\n            filename = asset['filename']\n            if not filename or asset['atype'] != 'text/javascript':\n                continue\n            with open(filename, 'r') as fp:\n                if RE_ONLY.search(fp.read()):\n                    self.fail(\"`QUnit.only()` used in file %r\" % asset['url'])\n", "comments": "      coding  utf 8        part odoo  see license file full copyright licensing details     webclient desktop test suite    webclient mobile test suite    verify js test using  qunit  forbid test executed    as currently request context  render  web layout      redefinied minimal proxy template  ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nimport re\nimport odoo.tests\n\nRE_ONLY = re.compile('QUnit\\.only\\(')\n\nclass WebSuite(odoo.tests.HttpCase):\n\n    post_install = True\n    at_install = False\n\n    def test_01_js(self):\n        # webclient desktop test suite\n        self.phantom_js('/web/tests?mod=web', \"\", \"\", login='admin', timeout=360)\n\n    def test_02_js(self):\n        # webclient mobile test suite\n        self.phantom_js('/web/tests/mobile?mod=web', \"\", \"\", login='admin', timeout=300)\n\n    def test_check_suite(self):\n        # verify no js test is using `QUnit.only` as it forbid any other test to be executed\n        self._check_only_call('web.qunit_suite')\n        self._check_only_call('web.qunit_mobile_suite')\n\n    def _check_only_call(self, suite):\n        # As we currently aren't in a request context, we can't render `web.layout`.\n        # redefinied it as a minimal proxy template.\n        self.env.ref('web.layout').write({'arch_db': '<t t-name=\"web.layout\"><t t-raw=\"head\"/></t>'})\n\n        for asset in self.env['ir.qweb']._get_asset_content(suite, options={})[0]:\n            filename = asset['filename']\n            if not filename or asset['atype'] != 'text/javascript':\n                continue\n            with open(filename, 'r') as fp:\n                if RE_ONLY.search(fp.read()):\n                    self.fail(\"`QUnit.only()` used in file %r\" % asset['url'])\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "test_js.py", "id": "8fcde5bc4f20a6a28b868db43d4df9d8", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/web/tests/test_js.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}