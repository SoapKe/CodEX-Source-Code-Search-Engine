{"author": "odoo", "code": "\nfrom odoo import api, fields, models\n\n\nclass CrmLeadConvert2Task(models.TransientModel):\n    \n\n    _name = \"crm.lead.convert2task\"\n    _inherit = 'crm.partner.binding'\n\n    @api.model\n    def default_get(self, fields):\n        result = super(CrmLeadConvert2Task, self).default_get(fields)\n        lead_id = self.env.context.get('active_id')\n        if lead_id:\n            result['lead_id'] = lead_id\n        return result\n\n    lead_id = fields.Many2one('crm.lead', string='Lead', domain=[('type', '=', 'lead')])\n    project_id = fields.Many2one('project.project', string='Project')\n\n    @api.multi\n    def action_lead_to_project_task(self):\n        self.ensure_one()\n        \n        lead = self.lead_id\n        partner_id = self._find_matching_partner()\n        if not partner_id and (lead.partner_name or lead.contact_name):\n            partner_id = lead.handle_partner_assignation()[lead.id]\n        \n        vals = {\n            \"name\": lead.name,\n            \"description\": lead.description,\n            \"email_from\": lead.email_from,\n            \"project_id\": self.project_id.id,\n            \"partner_id\": partner_id,\n            \"user_id\": None\n        }\n        task = self.env['project.task'].create(vals)\n        \n        lead.message_change_thread(task)\n        \n        attachments = self.env['ir.attachment'].search([('res_model', '=', 'crm.lead'), ('res_id', '=', lead.id)])\n        attachments.write({'res_model': 'project.task', 'res_id': task.id})\n        \n        lead.write({'active': False})\n        \n        view = self.env.ref('project.view_task_form2')\n        return {\n            'name': 'Task created',\n            'view_type': 'form',\n            'view_mode': 'form',\n            'view_id': view.id,\n            'res_model': 'project.task',\n            'type': 'ir.actions.act_window',\n            'res_id': task.id,\n            'context': self.env.context\n        }\n", "comments": "    wizard convert lead project task move mail thread        get lead transform    create new project task    move mail thread    move attachments    archive lead    return action go form view new task ", "content": "\nfrom odoo import api, fields, models\n\n\nclass CrmLeadConvert2Task(models.TransientModel):\n    \"\"\" wizard to convert a Lead into a Project task and move the Mail Thread \"\"\"\n\n    _name = \"crm.lead.convert2task\"\n    _inherit = 'crm.partner.binding'\n\n    @api.model\n    def default_get(self, fields):\n        result = super(CrmLeadConvert2Task, self).default_get(fields)\n        lead_id = self.env.context.get('active_id')\n        if lead_id:\n            result['lead_id'] = lead_id\n        return result\n\n    lead_id = fields.Many2one('crm.lead', string='Lead', domain=[('type', '=', 'lead')])\n    project_id = fields.Many2one('project.project', string='Project')\n\n    @api.multi\n    def action_lead_to_project_task(self):\n        self.ensure_one()\n        # get the lead to transform\n        lead = self.lead_id\n        partner_id = self._find_matching_partner()\n        if not partner_id and (lead.partner_name or lead.contact_name):\n            partner_id = lead.handle_partner_assignation()[lead.id]\n        # create new project.task\n        vals = {\n            \"name\": lead.name,\n            \"description\": lead.description,\n            \"email_from\": lead.email_from,\n            \"project_id\": self.project_id.id,\n            \"partner_id\": partner_id,\n            \"user_id\": None\n        }\n        task = self.env['project.task'].create(vals)\n        # move the mail thread\n        lead.message_change_thread(task)\n        # move attachments\n        attachments = self.env['ir.attachment'].search([('res_model', '=', 'crm.lead'), ('res_id', '=', lead.id)])\n        attachments.write({'res_model': 'project.task', 'res_id': task.id})\n        # archive the lead\n        lead.write({'active': False})\n        # return the action to go to the form view of the new Task\n        view = self.env.ref('project.view_task_form2')\n        return {\n            'name': 'Task created',\n            'view_type': 'form',\n            'view_mode': 'form',\n            'view_id': view.id,\n            'res_model': 'project.task',\n            'type': 'ir.actions.act_window',\n            'res_id': task.id,\n            'context': self.env.context\n        }\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "crm_lead_convert2task.py", "id": "974f513f6e0bf7c8feb3b40e03432ba9", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/crm_project/wizard/crm_lead_convert2task.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}