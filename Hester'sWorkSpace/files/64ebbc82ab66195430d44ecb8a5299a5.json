{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nfrom odoo import models\n\n\nclass AccountInvoiceLine(models.Model):\n\n    _inherit = ['account.invoice.line']\n\n    def get_digital_purchases(self):\n        partner = self.env.user.partner_id\n\n        \n        purchases = self.sudo().search_read(\n            domain=[('invoice_id.state', '=', 'paid'), ('invoice_id.partner_id', '=', partner.id)],\n            fields=['product_id'],\n        )\n\n        \n        purchases += self.env['sale.order.line'].sudo().search_read(\n            domain=[('price_subtotal', '=', 0.0), ('order_id.partner_id', '=', partner.id)],\n            fields=['product_id'],\n        )\n\n        \n        # (product_id: <id>, name: <product code> <template_name> <attributes>)\n        return [line['product_id'][0] for line in purchases]\n", "comments": "      coding  utf 8        part odoo  see license file full copyright licensing details     get paid invoices    get free products    i want product ids  search read insists giving list    (product id   id   name   product code   template name   attributes ) ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nfrom odoo import models\n\n\nclass AccountInvoiceLine(models.Model):\n\n    _inherit = ['account.invoice.line']\n\n    def get_digital_purchases(self):\n        partner = self.env.user.partner_id\n\n        # Get paid invoices\n        purchases = self.sudo().search_read(\n            domain=[('invoice_id.state', '=', 'paid'), ('invoice_id.partner_id', '=', partner.id)],\n            fields=['product_id'],\n        )\n\n        # Get free products\n        purchases += self.env['sale.order.line'].sudo().search_read(\n            domain=[('price_subtotal', '=', 0.0), ('order_id.partner_id', '=', partner.id)],\n            fields=['product_id'],\n        )\n\n        # I only want product_ids, but search_read insists in giving me a list of\n        # (product_id: <id>, name: <product code> <template_name> <attributes>)\n        return [line['product_id'][0] for line in purchases]\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "account_invoice.py", "id": "64ebbc82ab66195430d44ecb8a5299a5", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/website_sale_digital/models/account_invoice.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}