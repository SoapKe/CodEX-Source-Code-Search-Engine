{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nfrom odoo import api, fields, models, tools\n\n\nclass TestMassMailing(models.TransientModel):\n    _name = 'mail.mass_mailing.test'\n    _description = 'Sample Mail Wizard'\n\n    email_to = fields.Char(string='Recipients', required=True,\n                           help='Comma-separated list of email addresses.', default=lambda self: self.env['mail.message']._get_default_from())\n    mass_mailing_id = fields.Many2one('mail.mass_mailing', string='Mailing', required=True, ondelete='cascade')\n\n    @api.multi\n    def send_mail_test(self):\n        self.ensure_one()\n        mails = self.env['mail.mail']\n        mailing = self.mass_mailing_id\n        test_emails = tools.email_split(self.email_to)\n        for test_mail in test_emails:\n            \n            mailing.write({'body_html': self.env['mail.template']._replace_local_links(mailing.body_html)})\n            mail_values = {\n                'email_from': mailing.email_from,\n                'reply_to': mailing.reply_to,\n                'email_to': test_mail,\n                'subject': mailing.name,\n                'body_html': mailing.body_html,\n                'notification': True,\n                'mailing_id': mailing.id,\n                'attachment_ids': [(4, attachment.id) for attachment in mailing.attachment_ids],\n                'auto_delete': True,\n            }\n            mail = self.env['mail.mail'].create(mail_values)\n            mails |= mail\n        mails.send()\n        return True\n", "comments": "      coding  utf 8        part odoo  see license file full copyright licensing details     convert links absolute urls application shortener ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nfrom odoo import api, fields, models, tools\n\n\nclass TestMassMailing(models.TransientModel):\n    _name = 'mail.mass_mailing.test'\n    _description = 'Sample Mail Wizard'\n\n    email_to = fields.Char(string='Recipients', required=True,\n                           help='Comma-separated list of email addresses.', default=lambda self: self.env['mail.message']._get_default_from())\n    mass_mailing_id = fields.Many2one('mail.mass_mailing', string='Mailing', required=True, ondelete='cascade')\n\n    @api.multi\n    def send_mail_test(self):\n        self.ensure_one()\n        mails = self.env['mail.mail']\n        mailing = self.mass_mailing_id\n        test_emails = tools.email_split(self.email_to)\n        for test_mail in test_emails:\n            # Convert links in absolute URLs before the application of the shortener\n            mailing.write({'body_html': self.env['mail.template']._replace_local_links(mailing.body_html)})\n            mail_values = {\n                'email_from': mailing.email_from,\n                'reply_to': mailing.reply_to,\n                'email_to': test_mail,\n                'subject': mailing.name,\n                'body_html': mailing.body_html,\n                'notification': True,\n                'mailing_id': mailing.id,\n                'attachment_ids': [(4, attachment.id) for attachment in mailing.attachment_ids],\n                'auto_delete': True,\n            }\n            mail = self.env['mail.mail'].create(mail_values)\n            mails |= mail\n        mails.send()\n        return True\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "test_mailing.py", "id": "0061a4b513b18291be71aa2f2a2ac760", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/mass_mailing/wizard/test_mailing.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}