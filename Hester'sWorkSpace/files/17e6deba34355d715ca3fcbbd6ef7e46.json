{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nfrom lxml import etree\n\nfrom odoo import api, models, fields\nfrom odoo.tools.translate import _\n\n\nclass Partner(models.Model):\n    _inherit = 'res.partner'\n\n    country_enforce_cities = fields.Boolean(related='country_id.enforce_cities')\n    city_id = fields.Many2one('res.city', string='City')\n\n    @api.onchange('city_id')\n    def _onchange_city_id(self):\n        self.city = self.city_id.name\n        self.zip = self.city_id.zipcode\n        self.state_id = self.city_id.state_id\n\n    @api.model\n    def _fields_view_get_address(self, arch):\n        arch = super(Partner, self)._fields_view_get_address(arch)\n        \n        doc = etree.fromstring(arch)\n        if doc.xpath(\"//field[@name='city_id']\"):\n           return arch\n        for city_node in doc.xpath(\"//field[@name='city']\"):\n            replacement_xml = \"\"\"\n            <div>\n                <field name=\"country_enforce_cities\" invisible=\"1\"/>\n                <field name='city' placeholder=\"%s\" attrs=\"{'invisible': [('country_enforce_cities', '=', True), ('city_id', '!=', False)], 'readonly': [('type', '=', 'contact'), ('parent_id', '!=', False)]}\"/>\n                <field name='city_id' placeholder=\"%s\" attrs=\"{'invisible': [('country_enforce_cities', '=', False)], 'readonly': [('type', '=', 'contact'), ('parent_id', '!=', False)]}\" context=\"{'default_country_id': country_id}\" domain=\"[('country_id', '=', country_id)]\"/>\n            </div>\n            \"\"\" % (_('City'), _('City'))\n            city_id_node = etree.fromstring(replacement_xml)\n            city_node.getparent().replace(city_node, city_id_node)\n\n        arch = etree.tostring(doc, encoding='unicode')\n        return arch\n", "comments": "                 div                   field name  country enforce cities  invisible  1                     field name  city  placeholder    attrs    invisible    ( country enforce cities        true)  ( city id         false)    readonly    ( type         contact )  ( parent id         false)                       field name  city id  placeholder    attrs    invisible    ( country enforce cities        false)    readonly    ( type         contact )  ( parent id         false)    context    default country id   country id   domain   ( country id        country id)                   div                         coding  utf 8        part odoo  see license file full copyright licensing details     render partner address accordingly address view id ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nfrom lxml import etree\n\nfrom odoo import api, models, fields\nfrom odoo.tools.translate import _\n\n\nclass Partner(models.Model):\n    _inherit = 'res.partner'\n\n    country_enforce_cities = fields.Boolean(related='country_id.enforce_cities')\n    city_id = fields.Many2one('res.city', string='City')\n\n    @api.onchange('city_id')\n    def _onchange_city_id(self):\n        self.city = self.city_id.name\n        self.zip = self.city_id.zipcode\n        self.state_id = self.city_id.state_id\n\n    @api.model\n    def _fields_view_get_address(self, arch):\n        arch = super(Partner, self)._fields_view_get_address(arch)\n        # render the partner address accordingly to address_view_id\n        doc = etree.fromstring(arch)\n        if doc.xpath(\"//field[@name='city_id']\"):\n           return arch\n        for city_node in doc.xpath(\"//field[@name='city']\"):\n            replacement_xml = \"\"\"\n            <div>\n                <field name=\"country_enforce_cities\" invisible=\"1\"/>\n                <field name='city' placeholder=\"%s\" attrs=\"{'invisible': [('country_enforce_cities', '=', True), ('city_id', '!=', False)], 'readonly': [('type', '=', 'contact'), ('parent_id', '!=', False)]}\"/>\n                <field name='city_id' placeholder=\"%s\" attrs=\"{'invisible': [('country_enforce_cities', '=', False)], 'readonly': [('type', '=', 'contact'), ('parent_id', '!=', False)]}\" context=\"{'default_country_id': country_id}\" domain=\"[('country_id', '=', country_id)]\"/>\n            </div>\n            \"\"\" % (_('City'), _('City'))\n            city_id_node = etree.fromstring(replacement_xml)\n            city_node.getparent().replace(city_node, city_id_node)\n\n        arch = etree.tostring(doc, encoding='unicode')\n        return arch\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "res_partner.py", "id": "17e6deba34355d715ca3fcbbd6ef7e46", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/base_address_city/models/res_partner.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}