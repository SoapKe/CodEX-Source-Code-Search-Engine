{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nimport werkzeug\n\nfrom odoo.addons.mail.controllers.main import MailController\nfrom odoo.exceptions import AccessError\nfrom odoo.http import request\nfrom odoo.tools.misc import consteq\n\n\nclass MailController(MailController):\n\n    @classmethod\n    def _redirect_to_record(cls, model, res_id, access_token=None):\n        \n        \n        if model == 'account.invoice' and res_id and access_token:\n            uid = request.session.uid or request.env.ref('base.public_user').id\n            record_sudo = request.env[model].sudo().browse(res_id).exists()\n            try:\n                record_sudo.sudo(uid).check_access_rights('read')\n                record_sudo.sudo(uid).check_access_rule('read')\n            except AccessError:\n                if record_sudo.access_token and consteq(record_sudo.access_token, access_token):\n                    record_action = record_sudo.with_context(\n                        force_website=True).get_access_action(uid)\n                    if record_action['type'] == 'ir.actions.act_url':\n                        return werkzeug.utils.redirect(record_action['url'])\n        return super(MailController, cls)._redirect_to_record(model, res_id, access_token=access_token)\n", "comments": "      coding  utf 8        part odoo  see license file full copyright licensing details     if current user access invoice  provided    valid access token  redirect front end view  ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nimport werkzeug\n\nfrom odoo.addons.mail.controllers.main import MailController\nfrom odoo.exceptions import AccessError\nfrom odoo.http import request\nfrom odoo.tools.misc import consteq\n\n\nclass MailController(MailController):\n\n    @classmethod\n    def _redirect_to_record(cls, model, res_id, access_token=None):\n        # If the current user doesn't have access to the invoice, but provided\n        # a valid access token, redirect him to the front-end view.\n        if model == 'account.invoice' and res_id and access_token:\n            uid = request.session.uid or request.env.ref('base.public_user').id\n            record_sudo = request.env[model].sudo().browse(res_id).exists()\n            try:\n                record_sudo.sudo(uid).check_access_rights('read')\n                record_sudo.sudo(uid).check_access_rule('read')\n            except AccessError:\n                if record_sudo.access_token and consteq(record_sudo.access_token, access_token):\n                    record_action = record_sudo.with_context(\n                        force_website=True).get_access_action(uid)\n                    if record_action['type'] == 'ir.actions.act_url':\n                        return werkzeug.utils.redirect(record_action['url'])\n        return super(MailController, cls)._redirect_to_record(model, res_id, access_token=access_token)\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "mail.py", "id": "fa0342146b9df92ddf4a77d92555dd4d", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/account/controllers/mail.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}