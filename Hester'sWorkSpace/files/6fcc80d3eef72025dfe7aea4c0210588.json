{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nimport logging\nimport os\nimport subprocess\nimport threading\n\nfrom odoo import http\n\nfrom odoo.addons.hw_proxy.controllers import main as hw_proxy\n\n_logger = logging.getLogger(__name__)\n\nupgrade_template = \"\"\"\n<!DOCTYPE HTML>\n<html>\n    <head>\n        <title>Odoo's PosBox - Software Upgrade</title>\n        <script src=\"http://code.jquery.com/jquery-1.11.0.min.js\"></script>\n        <script>\n        $(function(){\n            var upgrading = false;\n            $('#upgrade').click(function(){\n                console.log('click');\n                if(!upgrading){\n                    upgrading = true;\n                    $('#upgrade').text('Upgrading, Please Wait');\n                    $.ajax({\n                        url:'/hw_proxy/perform_upgrade/'\n                    }).then(function(status){\n                        $('#upgrade').html('Upgrade successful, restarting the posbox...');\n                        $('#upgrade').off('click');\n                    },function(){\n                        $('#upgrade').text('Upgrade Failed');\n                    });\n                }\n            });\n        });\n        </script>\n        <style>\n        body {\n            width: 480px;\n            margin: 60px auto;\n            font-family: sans-serif;\n            text-align: justify;\n            color: \n        }\n        .centering{\n            text-align: center;\n        }\n        \n            padding: 20px;\n            background: rgb(121, 197, 107);\n            color: white;\n            border-radius: 3px;\n            text-align: center;\n            margin: 30px; \n            text-decoration: none;\n            display: inline-block;\n        }\n        </style>\n    </head>\n    <body>\n        <h1>PosBox Software Upgrade</h1>\n        <p>\n        This tool will help you perform an upgrade of the PosBox's software over the\n\tinternet. \n\t<p></p>\n        However the preferred method to upgrade the posbox is to flash the sd-card with\n        the <a href='http://nightly.odoo.com/trunk/posbox/'>latest image</a>. The upgrade\n        procedure is explained into to the\n        <a href='https://www.odoo.com/documentation/user/point_of_sale/posbox/index.html'>PosBox manual</a>\n        </p>\n        <p>\n        To upgrade the posbox, click on the upgrade button. The upgrade will take a few minutes. <b>Do not reboot</b> the PosBox during the upgrade.\n        </p>\n        <p>\n        Latest patch:\n        </p>\n        <pre>\n\"\"\"\nupgrade_template += subprocess.check_output(\"git --work-tree=/home/pi/odoo/ --git-dir=/home/pi/odoo/.git log -1\", shell=True).replace(\"\\n\", \"<br/>\")\nupgrade_template += \"\"\"\n        </pre>\n        <div class='centering'>\n            <a href='#' id='upgrade'>Upgrade</a>\n        </div>\n    </body>\n</html>\n\n\"\"\"\n\nclass PosboxUpgrader(hw_proxy.Proxy):\n    def __init__(self):\n        super(PosboxUpgrader,self).__init__()\n        self.upgrading = threading.Lock()\n\n    @http.route('/hw_proxy/upgrade', type='http', auth='none', )\n    def upgrade(self):\n        return upgrade_template \n    \n    @http.route('/hw_proxy/perform_upgrade', type='http', auth='none')\n    def perform_upgrade(self):\n        self.upgrading.acquire()\n\n        os.system('/home/pi/odoo/addons/point_of_sale/tools/posbox/configuration/posbox_update.sh')\n        \n        self.upgrading.release()\n        return 'SUCCESS'\n", "comments": "      doctype html   html       head           title odoo posbox   software upgrade  title           script src  http   code jquery com jquery 1 11 0 min js    script           script           (function()              var upgrading   false               (  upgrade ) click(function()                  console log( click )                  if( upgrading)                      upgrading   true                       (  upgrade ) text( upgrading  please wait )                        ajax(                          url   hw proxy perform upgrade                        ) then(function(status)                           (  upgrade ) html( upgrade successful  restarting posbox    )                           (  upgrade ) off( click )                        function()                           (  upgrade ) text( upgrade failed )                       )                                 )           )            script           style          body               width  480px              margin  60px auto              font family  sans serif              text align  justify              color   6b6b6b                     centering              text align  center                     upgrade               padding  20px              background  rgb(121  197  107)              color  white              border radius  3px              text align  center              margin  30px               text decoration  none              display  inline block                      style        head       body           h1 posbox software upgrade  h1           p          this tool help perform upgrade posbox software  internet     p   p          however preferred method upgrade posbox flash sd card          href  http   nightly odoo com trunk posbox   latest image    the upgrade         procedure explained          href  https   www odoo com documentation user point sale posbox index html  posbox manual             p           p          to upgrade posbox  click upgrade button  the upgrade take minutes   b do reboot  b  posbox upgrade            p           p          latest patch            p           pre      upgrade template    subprocess check output( git   work tree  home pi odoo    git dir  home pi odoo  git log  1   shell true) replace(  n     br   ) upgrade template                  pre           div class  centering                href     id  upgrade  upgrade             div        body    html              coding  utf 8        part odoo  see license file full copyright licensing details    6b6b6b    upgrade   ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nimport logging\nimport os\nimport subprocess\nimport threading\n\nfrom odoo import http\n\nfrom odoo.addons.hw_proxy.controllers import main as hw_proxy\n\n_logger = logging.getLogger(__name__)\n\nupgrade_template = \"\"\"\n<!DOCTYPE HTML>\n<html>\n    <head>\n        <title>Odoo's PosBox - Software Upgrade</title>\n        <script src=\"http://code.jquery.com/jquery-1.11.0.min.js\"></script>\n        <script>\n        $(function(){\n            var upgrading = false;\n            $('#upgrade').click(function(){\n                console.log('click');\n                if(!upgrading){\n                    upgrading = true;\n                    $('#upgrade').text('Upgrading, Please Wait');\n                    $.ajax({\n                        url:'/hw_proxy/perform_upgrade/'\n                    }).then(function(status){\n                        $('#upgrade').html('Upgrade successful, restarting the posbox...');\n                        $('#upgrade').off('click');\n                    },function(){\n                        $('#upgrade').text('Upgrade Failed');\n                    });\n                }\n            });\n        });\n        </script>\n        <style>\n        body {\n            width: 480px;\n            margin: 60px auto;\n            font-family: sans-serif;\n            text-align: justify;\n            color: #6B6B6B;\n        }\n        .centering{\n            text-align: center;\n        }\n        #upgrade {\n            padding: 20px;\n            background: rgb(121, 197, 107);\n            color: white;\n            border-radius: 3px;\n            text-align: center;\n            margin: 30px; \n            text-decoration: none;\n            display: inline-block;\n        }\n        </style>\n    </head>\n    <body>\n        <h1>PosBox Software Upgrade</h1>\n        <p>\n        This tool will help you perform an upgrade of the PosBox's software over the\n\tinternet. \n\t<p></p>\n        However the preferred method to upgrade the posbox is to flash the sd-card with\n        the <a href='http://nightly.odoo.com/trunk/posbox/'>latest image</a>. The upgrade\n        procedure is explained into to the\n        <a href='https://www.odoo.com/documentation/user/point_of_sale/posbox/index.html'>PosBox manual</a>\n        </p>\n        <p>\n        To upgrade the posbox, click on the upgrade button. The upgrade will take a few minutes. <b>Do not reboot</b> the PosBox during the upgrade.\n        </p>\n        <p>\n        Latest patch:\n        </p>\n        <pre>\n\"\"\"\nupgrade_template += subprocess.check_output(\"git --work-tree=/home/pi/odoo/ --git-dir=/home/pi/odoo/.git log -1\", shell=True).replace(\"\\n\", \"<br/>\")\nupgrade_template += \"\"\"\n        </pre>\n        <div class='centering'>\n            <a href='#' id='upgrade'>Upgrade</a>\n        </div>\n    </body>\n</html>\n\n\"\"\"\n\nclass PosboxUpgrader(hw_proxy.Proxy):\n    def __init__(self):\n        super(PosboxUpgrader,self).__init__()\n        self.upgrading = threading.Lock()\n\n    @http.route('/hw_proxy/upgrade', type='http', auth='none', )\n    def upgrade(self):\n        return upgrade_template \n    \n    @http.route('/hw_proxy/perform_upgrade', type='http', auth='none')\n    def perform_upgrade(self):\n        self.upgrading.acquire()\n\n        os.system('/home/pi/odoo/addons/point_of_sale/tools/posbox/configuration/posbox_update.sh')\n        \n        self.upgrading.release()\n        return 'SUCCESS'\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "main.py", "id": "6fcc80d3eef72025dfe7aea4c0210588", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/hw_posbox_upgrade/controllers/main.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}