{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nfrom odoo import api, models\n\n\nclass BomStructureReport(models.AbstractModel):\n    _name = 'report.mrp.mrp_bom_structure_report'\n\n    def get_children(self, object, level=0):\n        result = []\n\n        def _get_rec(object, level, qty=1.0, uom=False):\n            for l in object:\n                res = {}\n                res['pname'] = l.product_id.name_get()[0][1]\n                res['pcode'] = l.product_id.default_code\n                qty_per_bom = l.bom_id.product_qty\n                if uom:\n                    if uom != l.bom_id.product_uom_id:\n                        qty = uom._compute_quantity(qty, l.bom_id.product_uom_id)\n                    res['pqty'] = (l.product_qty *qty)/ qty_per_bom\n                else:\n                    \n                    res['pqty'] = (l.product_qty *qty)\n                res['puom'] = l.product_uom_id\n                res['uname'] = l.product_uom_id.name\n                res['level'] = level\n                res['code'] = l.bom_id.code\n                result.append(res)\n                if l.child_line_ids:\n                    if level < 6:\n                        level += 1\n                    _get_rec(l.child_line_ids, level, qty=res['pqty'], uom=res['puom'])\n                    if level > 0 and level < 6:\n                        level -= 1\n            return result\n\n        children = _get_rec(object, level)\n\n        return children\n\n    @api.multi\n    def get_report_values(self, docids, data=None):\n        return {\n            'doc_ids': docids,\n            'doc_model': 'mrp.bom',\n            'docs': self.env['mrp.bom'].browse(docids),\n            'get_children': self.get_children,\n            'data': data,\n        }\n", "comments": "      coding  utf 8        part odoo  see license file full copyright licensing details    first case  ponderation right ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nfrom odoo import api, models\n\n\nclass BomStructureReport(models.AbstractModel):\n    _name = 'report.mrp.mrp_bom_structure_report'\n\n    def get_children(self, object, level=0):\n        result = []\n\n        def _get_rec(object, level, qty=1.0, uom=False):\n            for l in object:\n                res = {}\n                res['pname'] = l.product_id.name_get()[0][1]\n                res['pcode'] = l.product_id.default_code\n                qty_per_bom = l.bom_id.product_qty\n                if uom:\n                    if uom != l.bom_id.product_uom_id:\n                        qty = uom._compute_quantity(qty, l.bom_id.product_uom_id)\n                    res['pqty'] = (l.product_qty *qty)/ qty_per_bom\n                else:\n                    #for the first case, the ponderation is right\n                    res['pqty'] = (l.product_qty *qty)\n                res['puom'] = l.product_uom_id\n                res['uname'] = l.product_uom_id.name\n                res['level'] = level\n                res['code'] = l.bom_id.code\n                result.append(res)\n                if l.child_line_ids:\n                    if level < 6:\n                        level += 1\n                    _get_rec(l.child_line_ids, level, qty=res['pqty'], uom=res['puom'])\n                    if level > 0 and level < 6:\n                        level -= 1\n            return result\n\n        children = _get_rec(object, level)\n\n        return children\n\n    @api.multi\n    def get_report_values(self, docids, data=None):\n        return {\n            'doc_ids': docids,\n            'doc_model': 'mrp.bom',\n            'docs': self.env['mrp.bom'].browse(docids),\n            'get_children': self.get_children,\n            'data': data,\n        }\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "mrp_bom_structure_report.py", "id": "f1aee4f1e8dc0328d9ce3ebda7db71e7", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/mrp/report/mrp_bom_structure_report.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}