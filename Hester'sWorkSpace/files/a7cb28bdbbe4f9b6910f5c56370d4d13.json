{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nimport json\nfrom werkzeug.utils import redirect\n\nfrom odoo import http, registry\nfrom odoo.http import request\n\n\nclass GoogleAuth(http.Controller):\n\n    @http.route('/google_account/authentication', type='http', auth=\"none\")\n    def oauth2callback(self, **kw):\n        \n        state = json.loads(kw['state'])\n        dbname = state.get('d')\n        service = state.get('s')\n        url_return = state.get('f')\n\n        with registry(dbname).cursor() as cr:\n            if kw.get('code'):\n                request.env(cr, request.session.uid)['google.%s' % service].set_all_tokens(kw['code'])\n                return redirect(url_return)\n            elif kw.get('error'):\n                return redirect(\"%s%s%s\" % (url_return, \"?error=\", kw['error']))\n            else:\n                return redirect(\"%s%s\" % (url_return, \"?error=Unknown_error\"))\n", "comments": "    this route function called google user accept refuse consent google            coding  utf 8        part odoo  see license file full copyright licensing details  ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nimport json\nfrom werkzeug.utils import redirect\n\nfrom odoo import http, registry\nfrom odoo.http import request\n\n\nclass GoogleAuth(http.Controller):\n\n    @http.route('/google_account/authentication', type='http', auth=\"none\")\n    def oauth2callback(self, **kw):\n        \"\"\" This route/function is called by Google when user Accept/Refuse the consent of Google \"\"\"\n        state = json.loads(kw['state'])\n        dbname = state.get('d')\n        service = state.get('s')\n        url_return = state.get('f')\n\n        with registry(dbname).cursor() as cr:\n            if kw.get('code'):\n                request.env(cr, request.session.uid)['google.%s' % service].set_all_tokens(kw['code'])\n                return redirect(url_return)\n            elif kw.get('error'):\n                return redirect(\"%s%s%s\" % (url_return, \"?error=\", kw['error']))\n            else:\n                return redirect(\"%s%s\" % (url_return, \"?error=Unknown_error\"))\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "main.py", "id": "a7cb28bdbbe4f9b6910f5c56370d4d13", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/google_account/controllers/main.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}