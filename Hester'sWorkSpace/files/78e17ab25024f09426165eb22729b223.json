{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nfrom odoo import api, fields, models\n\n\nclass AccountAnalyticDefault(models.Model):\n    _name = \"account.analytic.default\"\n    _description = \"Analytic Distribution\"\n    _rec_name = \"analytic_id\"\n    _order = \"sequence\"\n\n    sequence = fields.Integer(string='Sequence', help=\"Gives the sequence order when displaying a list of analytic distribution\")\n    analytic_id = fields.Many2one('account.analytic.account', string='Analytic Account')\n    product_id = fields.Many2one('product.product', string='Product', ondelete='cascade', help=\"Select a product which will use analytic account specified in analytic default (e.g. create new customer invoice or Sales order if we select this product, it will automatically take this as an analytic account)\")\n    partner_id = fields.Many2one('res.partner', string='Partner', ondelete='cascade', help=\"Select a partner which will use analytic account specified in analytic default (e.g. create new customer invoice or Sales order if we select this partner, it will automatically take this as an analytic account)\")\n    user_id = fields.Many2one('res.users', string='User', ondelete='cascade', help=\"Select a user which will use analytic account specified in analytic default.\")\n    company_id = fields.Many2one('res.company', string='Company', ondelete='cascade', help=\"Select a company which will use analytic account specified in analytic default (e.g. create new customer invoice or Sales order if we select this company, it will automatically take this as an analytic account)\")\n    date_start = fields.Date(string='Start Date', help=\"Default start date for this Analytic Account.\")\n    date_stop = fields.Date(string='End Date', help=\"Default end date for this Analytic Account.\")\n\n    @api.model\n    def account_get(self, product_id=None, partner_id=None, user_id=None, date=None, company_id=None):\n        domain = []\n        if product_id:\n            domain += ['|', ('product_id', '=', product_id)]\n        domain += [('product_id', '=', False)]\n        if partner_id:\n            domain += ['|', ('partner_id', '=', partner_id)]\n        domain += [('partner_id', '=', False)]\n        if company_id:\n            domain += ['|', ('company_id', '=', company_id)]\n        domain += [('company_id', '=', False)]\n        if user_id:\n            domain += ['|', ('user_id', '=', user_id)]\n        domain += [('user_id', '=', False)]\n        if date:\n            domain += ['|', ('date_start', '<=', date), ('date_start', '=', False)]\n            domain += ['|', ('date_stop', '>=', date), ('date_stop', '=', False)]\n        best_index = -1\n        res = self.env['account.analytic.default']\n        for rec in self.search(domain):\n            index = 0\n            if rec.product_id: index += 1\n            if rec.partner_id: index += 1\n            if rec.company_id: index += 1\n            if rec.user_id: index += 1\n            if rec.date_start: index += 1\n            if rec.date_stop: index += 1\n            if index > best_index:\n                res = rec\n                best_index = index\n        return res\n\n\nclass AccountInvoiceLine(models.Model):\n    _inherit = \"account.invoice.line\"\n\n    @api.onchange('product_id')\n    def _onchange_product_id(self):\n        res = super(AccountInvoiceLine, self)._onchange_product_id()\n        rec = self.env['account.analytic.default'].account_get(self.product_id.id, self.invoice_id.commercial_partner_id.id, self.env.uid,\n                                                               fields.Date.today(), company_id=self.company_id.id)\n        self.account_analytic_id = rec.analytic_id.id\n        return res\n\n    def _set_additional_fields(self, invoice):\n        if not self.account_analytic_id:\n            rec = self.env['account.analytic.default'].account_get(\n                self.product_id.id, self.invoice_id.commercial_partner_id.id, self.env.uid,\n                fields.Date.today(), company_id=self.company_id.id)\n            if rec:\n                self.account_analytic_id = rec.analytic_id.id\n        super(AccountInvoiceLine, self)._set_additional_fields(invoice)\n", "comments": "      coding  utf 8        part odoo  see license file full copyright licensing details  ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nfrom odoo import api, fields, models\n\n\nclass AccountAnalyticDefault(models.Model):\n    _name = \"account.analytic.default\"\n    _description = \"Analytic Distribution\"\n    _rec_name = \"analytic_id\"\n    _order = \"sequence\"\n\n    sequence = fields.Integer(string='Sequence', help=\"Gives the sequence order when displaying a list of analytic distribution\")\n    analytic_id = fields.Many2one('account.analytic.account', string='Analytic Account')\n    product_id = fields.Many2one('product.product', string='Product', ondelete='cascade', help=\"Select a product which will use analytic account specified in analytic default (e.g. create new customer invoice or Sales order if we select this product, it will automatically take this as an analytic account)\")\n    partner_id = fields.Many2one('res.partner', string='Partner', ondelete='cascade', help=\"Select a partner which will use analytic account specified in analytic default (e.g. create new customer invoice or Sales order if we select this partner, it will automatically take this as an analytic account)\")\n    user_id = fields.Many2one('res.users', string='User', ondelete='cascade', help=\"Select a user which will use analytic account specified in analytic default.\")\n    company_id = fields.Many2one('res.company', string='Company', ondelete='cascade', help=\"Select a company which will use analytic account specified in analytic default (e.g. create new customer invoice or Sales order if we select this company, it will automatically take this as an analytic account)\")\n    date_start = fields.Date(string='Start Date', help=\"Default start date for this Analytic Account.\")\n    date_stop = fields.Date(string='End Date', help=\"Default end date for this Analytic Account.\")\n\n    @api.model\n    def account_get(self, product_id=None, partner_id=None, user_id=None, date=None, company_id=None):\n        domain = []\n        if product_id:\n            domain += ['|', ('product_id', '=', product_id)]\n        domain += [('product_id', '=', False)]\n        if partner_id:\n            domain += ['|', ('partner_id', '=', partner_id)]\n        domain += [('partner_id', '=', False)]\n        if company_id:\n            domain += ['|', ('company_id', '=', company_id)]\n        domain += [('company_id', '=', False)]\n        if user_id:\n            domain += ['|', ('user_id', '=', user_id)]\n        domain += [('user_id', '=', False)]\n        if date:\n            domain += ['|', ('date_start', '<=', date), ('date_start', '=', False)]\n            domain += ['|', ('date_stop', '>=', date), ('date_stop', '=', False)]\n        best_index = -1\n        res = self.env['account.analytic.default']\n        for rec in self.search(domain):\n            index = 0\n            if rec.product_id: index += 1\n            if rec.partner_id: index += 1\n            if rec.company_id: index += 1\n            if rec.user_id: index += 1\n            if rec.date_start: index += 1\n            if rec.date_stop: index += 1\n            if index > best_index:\n                res = rec\n                best_index = index\n        return res\n\n\nclass AccountInvoiceLine(models.Model):\n    _inherit = \"account.invoice.line\"\n\n    @api.onchange('product_id')\n    def _onchange_product_id(self):\n        res = super(AccountInvoiceLine, self)._onchange_product_id()\n        rec = self.env['account.analytic.default'].account_get(self.product_id.id, self.invoice_id.commercial_partner_id.id, self.env.uid,\n                                                               fields.Date.today(), company_id=self.company_id.id)\n        self.account_analytic_id = rec.analytic_id.id\n        return res\n\n    def _set_additional_fields(self, invoice):\n        if not self.account_analytic_id:\n            rec = self.env['account.analytic.default'].account_get(\n                self.product_id.id, self.invoice_id.commercial_partner_id.id, self.env.uid,\n                fields.Date.today(), company_id=self.company_id.id)\n            if rec:\n                self.account_analytic_id = rec.analytic_id.id\n        super(AccountInvoiceLine, self)._set_additional_fields(invoice)\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "account_analytic_default.py", "id": "78e17ab25024f09426165eb22729b223", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/account_analytic_default/models/account_analytic_default.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}