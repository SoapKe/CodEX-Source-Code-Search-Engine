{"author": "tldr-pages", "code": "import json\nimport os\nimport sys\nimport urllib2\n\nURL = 'https://tldr-bot.starbeamrainbowlabs.com/'\n\ndef post_comment(pr_id, comment_body):\n  \n  req = urllib2.Request(URL,\n                       json.dumps({'body': comment_body, 'pr_id': pr_id }),\n                       {'Content-Type': 'application/json'})\n  \n  f = urllib2.urlopen(req)\n  if f.getcode() != 200:\n    print f.read()\n\n\n\nPR_NUMBER = os.environ.get('TRAVIS_PULL_REQUEST')\nBUILD_ID = os.environ.get('TRAVIS_BUILD_ID')\n\n\ntest_result = sys.stdin.read().strip()\n\ncomment = (\n\"The [build]\"\n\"(https://travis-ci.org/tldr-pages/tldr/builds/{build_id})\"\n\" for this PR has failed with the following error(s):\"\n\"\\n```\\n\"\n\"{comment_body}\"\n\"\\n```\\n\"\n\"Please fix the error(s) and push again.\"\n).format(build_id=BUILD_ID, comment_body=test_result)\n\n\nif PR_NUMBER != \"false\":\n  post_comment(PR_NUMBER, comment)\n", "comments": "  constructing url    making request    get environment variables    read test result output stdin    populate template text    if pr  post comment ", "content": "import json\nimport os\nimport sys\nimport urllib2\n\nURL = 'https://tldr-bot.starbeamrainbowlabs.com/'\n\ndef post_comment(pr_id, comment_body):\n  # Constructing the url\n  req = urllib2.Request(URL,\n                       json.dumps({'body': comment_body, 'pr_id': pr_id }),\n                       {'Content-Type': 'application/json'})\n  # Making the request\n  f = urllib2.urlopen(req)\n  if f.getcode() != 200:\n    print f.read()\n\n\n# Get the environment variables\nPR_NUMBER = os.environ.get('TRAVIS_PULL_REQUEST')\nBUILD_ID = os.environ.get('TRAVIS_BUILD_ID')\n\n# Read the test result output from stdin\ntest_result = sys.stdin.read().strip()\n# Populate the template text\ncomment = (\n\"The [build]\"\n\"(https://travis-ci.org/tldr-pages/tldr/builds/{build_id})\"\n\" for this PR has failed with the following error(s):\"\n\"\\n```\\n\"\n\"{comment_body}\"\n\"\\n```\\n\"\n\"Please fix the error(s) and push again.\"\n).format(build_id=BUILD_ID, comment_body=test_result)\n\n# If it's a PR, post a comment on it\nif PR_NUMBER != \"false\":\n  post_comment(PR_NUMBER, comment)\n", "description": ":books: Simplified and community-driven man pages", "file_name": "send_to_bot.py", "id": "a870aa0bb068f990cbfb44b51520cb24", "language": "Python", "project_name": "tldr", "quality": "", "save_path": "/home/ubuntu/test_files/clean/network_test/tldr-pages-tldr/tldr-pages-tldr-eff392c/scripts/send_to_bot.py", "save_time": "", "source": "", "update_at": "2018-03-14T01:59:08Z", "url": "https://github.com/tldr-pages/tldr", "wiki": true}