{"author": "odoo", "code": "# -*- coding: utf-8 -*-\nimport functools\n\nfrom odoo import _\nfrom odoo.exceptions import AccessError\nfrom odoo.http import Controller, route, request, Response\n\ndef webservice(f):\n    @functools.wraps(f)\n    def wrap(*args, **kw):\n        try:\n            return f(*args, **kw)\n        except Exception as e:\n            return Response(response=str(e), status=500)\n    return wrap\n\n\nclass ImportModule(Controller):\n\n    def check_user(self, uid=None):\n        if uid is None:\n            uid = request.uid\n        is_admin = request.env['res.users'].browse(uid)._is_admin()\n        if not is_admin:\n            raise AccessError(_(\"Only administrators can upload a module\"))\n\n    @route('/base_import_module/login', type='http', auth='none', methods=['POST'], csrf=False)\n    @webservice\n    def login(self, login, password, db=None):\n        if db and db != request.db:\n            raise Exception(_(\"Could not select database '%s'\") % db)\n        uid = request.session.authenticate(request.db, login, password)\n        if not uid:\n            return Response(response=\"Wrong login/password\", status=401)\n        self.check_user(uid)\n        return Response(headers={\n            'X-CSRF-TOKEN': request.csrf_token(),\n        })\n\n    @route('/base_import_module/upload', type='http', auth='user', methods=['POST'])\n    @webservice\n    def upload(self, mod_file=None, force='', **kw):\n        self.check_user()\n        force = True if force == '1' else False\n        return request.env['ir.module.module'].import_zipfile(mod_file, force=force)[0]\n", "comments": "      coding  utf 8     ", "content": "# -*- coding: utf-8 -*-\nimport functools\n\nfrom odoo import _\nfrom odoo.exceptions import AccessError\nfrom odoo.http import Controller, route, request, Response\n\ndef webservice(f):\n    @functools.wraps(f)\n    def wrap(*args, **kw):\n        try:\n            return f(*args, **kw)\n        except Exception as e:\n            return Response(response=str(e), status=500)\n    return wrap\n\n\nclass ImportModule(Controller):\n\n    def check_user(self, uid=None):\n        if uid is None:\n            uid = request.uid\n        is_admin = request.env['res.users'].browse(uid)._is_admin()\n        if not is_admin:\n            raise AccessError(_(\"Only administrators can upload a module\"))\n\n    @route('/base_import_module/login', type='http', auth='none', methods=['POST'], csrf=False)\n    @webservice\n    def login(self, login, password, db=None):\n        if db and db != request.db:\n            raise Exception(_(\"Could not select database '%s'\") % db)\n        uid = request.session.authenticate(request.db, login, password)\n        if not uid:\n            return Response(response=\"Wrong login/password\", status=401)\n        self.check_user(uid)\n        return Response(headers={\n            'X-CSRF-TOKEN': request.csrf_token(),\n        })\n\n    @route('/base_import_module/upload', type='http', auth='user', methods=['POST'])\n    @webservice\n    def upload(self, mod_file=None, force='', **kw):\n        self.check_user()\n        force = True if force == '1' else False\n        return request.env['ir.module.module'].import_zipfile(mod_file, force=force)[0]\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "main.py", "id": "240441fed44510caf520273d31a4c6bf", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/base_import_module/controllers/main.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}