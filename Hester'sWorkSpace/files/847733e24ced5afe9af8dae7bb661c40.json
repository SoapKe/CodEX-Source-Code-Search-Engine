{"author": "HelloZeroNet", "code": "import re\nfrom Plugin import PluginManager\n\n@PluginManager.registerTo(\"UiRequest\")\nclass UiRequestPlugin(object):\n\tdef __init__(self, server = None):\n\t\tfrom Site import SiteManager\n\t\tself.site_manager = SiteManager.site_manager\n\t\tsuper(UiRequestPlugin, self).__init__(server)\n\n\n\t\n\tdef actionSiteMedia(self, path):\n\t\tmatch = re.match(\"/media/(?P<address>[A-Za-z0-9-]+\\.[A-Za-z0-9\\.-]+)(?P<inner_path>/.*|$)\", path)\n\t\tif match: \n\t\t\tdomain = match.group(\"address\")\n\t\t\taddress = self.site_manager.resolveDomain(domain)\n\t\t\tif address:\n\t\t\t\tpath = \"/media/\"+address+match.group(\"inner_path\")\n\t\treturn super(UiRequestPlugin, self).actionSiteMedia(path) \n\n\n\t\n\tdef isMediaRequestAllowed(self, site_address, referer):\n\t\treferer_path = re.sub(\"http[s]{0,1}://.*?/\", \"/\", referer).replace(\"/media\", \"\") \n\t\treferer_site_address = re.match(\"/(?P<address>[A-Za-z0-9\\.-]+)(?P<inner_path>/.*|$)\", referer_path).group(\"address\")\n\n\t\tif referer_site_address == site_address: \n\t\t\treturn True\n\t\telif self.site_manager.resolveDomain(referer_site_address) == site_address: \n\t\t\treturn True\n\t\telse: \n\t\t\treturn False\n\n", "comments": "  media request    its valid domain  resolve first    get wrapper frame output    is mediarequest allowed referer    remove site address    referer site address simple address    referer site address dns    invalid referer ", "content": "import re\nfrom Plugin import PluginManager\n\n@PluginManager.registerTo(\"UiRequest\")\nclass UiRequestPlugin(object):\n\tdef __init__(self, server = None):\n\t\tfrom Site import SiteManager\n\t\tself.site_manager = SiteManager.site_manager\n\t\tsuper(UiRequestPlugin, self).__init__(server)\n\n\n\t# Media request\n\tdef actionSiteMedia(self, path):\n\t\tmatch = re.match(\"/media/(?P<address>[A-Za-z0-9-]+\\.[A-Za-z0-9\\.-]+)(?P<inner_path>/.*|$)\", path)\n\t\tif match: # Its a valid domain, resolve first\n\t\t\tdomain = match.group(\"address\")\n\t\t\taddress = self.site_manager.resolveDomain(domain)\n\t\t\tif address:\n\t\t\t\tpath = \"/media/\"+address+match.group(\"inner_path\")\n\t\treturn super(UiRequestPlugin, self).actionSiteMedia(path) # Get the wrapper frame output\n\n\n\t# Is mediarequest allowed from that referer\n\tdef isMediaRequestAllowed(self, site_address, referer):\n\t\treferer_path = re.sub(\"http[s]{0,1}://.*?/\", \"/\", referer).replace(\"/media\", \"\") # Remove site address\n\t\treferer_site_address = re.match(\"/(?P<address>[A-Za-z0-9\\.-]+)(?P<inner_path>/.*|$)\", referer_path).group(\"address\")\n\n\t\tif referer_site_address == site_address: # Referer site address as simple address\n\t\t\treturn True\n\t\telif self.site_manager.resolveDomain(referer_site_address) == site_address: # Referer site address as dns\n\t\t\treturn True\n\t\telse: # Invalid referer\n\t\t\treturn False\n\n", "description": "ZeroNet - Decentralized websites using Bitcoin crypto and BitTorrent network", "file_name": "UiRequestPlugin.py", "id": "847733e24ced5afe9af8dae7bb661c40", "language": "Python", "project_name": "ZeroNet", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/HelloZeroNet-ZeroNet/HelloZeroNet-ZeroNet-8828629/plugins/disabled-Dnschain/UiRequestPlugin.py", "save_time": "", "source": "", "update_at": "2018-03-18T12:17:52Z", "url": "https://github.com/HelloZeroNet/ZeroNet", "wiki": true}