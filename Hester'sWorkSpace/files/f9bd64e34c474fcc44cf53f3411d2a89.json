{"author": "rg3", "code": "\nfrom __future__ import unicode_literals\n\nfrom .common import InfoExtractor\nfrom ..utils import int_or_none\n\n\nclass R7IE(InfoExtractor):\n    _VALID_URL = r\n    _TESTS = [{\n        'url': 'http://videos.r7.com/policiais-humilham-suspeito-a-beira-da-morte-morre-com-dignidade-/idmedia/54e7050b0cf2ff57e0279389.html',\n        'md5': '403c4e393617e8e8ddc748978ee8efde',\n        'info_dict': {\n            'id': '54e7050b0cf2ff57e0279389',\n            'ext': 'mp4',\n            'title': 'Policiais humilham suspeito \u00e0 beira da morte: \"Morre com dignidade\"',\n            'description': 'md5:01812008664be76a6479aa58ec865b72',\n            'thumbnail': r're:^https?://.*\\.jpg$',\n            'duration': 98,\n            'like_count': int,\n            'view_count': int,\n        },\n    }, {\n        'url': 'http://esportes.r7.com/videos/cigano-manda-recado-aos-fas/idmedia/4e176727b51a048ee6646a1b.html',\n        'only_matching': True,\n    }, {\n        'url': 'http://noticias.r7.com/record-news/video/representante-do-instituto-sou-da-paz-fala-sobre-fim-do-estatuto-do-desarmamento-5480fc580cf2285b117f438d/',\n        'only_matching': True,\n    }, {\n        'url': 'http://player.r7.com/video/i/54e7050b0cf2ff57e0279389?play=true&video=http://vsh.r7.com/54e7050b0cf2ff57e0279389/ER7_RE_BG_MORTE_JOVENS_570kbps_2015-02-2009f17818-cc82-4c8f-86dc-89a66934e633-ATOS_copy.mp4&linkCallback=http://videos.r7.com/policiais-humilham-suspeito-a-beira-da-morte-morre-com-dignidade-/idmedia/54e7050b0cf2ff57e0279389.html&thumbnail=http://vtb.r7.com/ER7_RE_BG_MORTE_JOVENS_570kbps_2015-02-2009f17818-cc82-4c8f-86dc-89a66934e633-thumb.jpg&idCategory=192&share=true&layout=full&full=true',\n        'only_matching': True,\n    }]\n\n    def _real_extract(self, url):\n        video_id = self._match_id(url)\n\n        video = self._download_json(\n            'http://player-api.r7.com/video/i/%s' % video_id, video_id)\n\n        title = video['title']\n\n        formats = []\n        media_url_hls = video.get('media_url_hls')\n        if media_url_hls:\n            formats.extend(self._extract_m3u8_formats(\n                media_url_hls, video_id, 'mp4', entry_protocol='m3u8_native',\n                m3u8_id='hls', fatal=False))\n        media_url = video.get('media_url')\n        if media_url:\n            f = {\n                'url': media_url,\n                'format_id': 'http',\n            }\n            \n            \n            m3u8_formats = list(filter(\n                lambda f: f.get('vcodec') != 'none', formats))\n            if len(m3u8_formats) == 1:\n                f_copy = m3u8_formats[0].copy()\n                f_copy.update(f)\n                f_copy['protocol'] = 'http'\n                f = f_copy\n            formats.append(f)\n        self._sort_formats(formats)\n\n        description = video.get('description')\n        thumbnail = video.get('thumb')\n        duration = int_or_none(video.get('media_duration'))\n        like_count = int_or_none(video.get('likes'))\n        view_count = int_or_none(video.get('views'))\n\n        return {\n            'id': video_id,\n            'title': title,\n            'description': description,\n            'thumbnail': thumbnail,\n            'duration': duration,\n            'like_count': like_count,\n            'view_count': view_count,\n            'formats': formats,\n        }\n\n\nclass R7ArticleIE(InfoExtractor):\n    _VALID_URL = r'https?://(?:[a-zA-Z]+)\\.r7\\.com/(?:[^/]+/)+[^/?\n    _TEST = {\n        'url': 'http://tv.r7.com/record-play/balanco-geral/videos/policiais-humilham-suspeito-a-beira-da-morte-morre-com-dignidade-16102015',\n        'only_matching': True,\n    }\n\n    @classmethod\n    def suitable(cls, url):\n        return False if R7IE.suitable(url) else super(R7ArticleIE, cls).suitable(url)\n\n    def _real_extract(self, url):\n        display_id = self._match_id(url)\n\n        webpage = self._download_webpage(url, display_id)\n\n        video_id = self._search_regex(\n            r'<div[^>]+(?:id=[\"\\']player-|class=[\"\\']embed[\"\\'][^>]+id=[\"\\'])([\\da-f]{24})',\n            webpage, 'video id')\n\n        return self.url_result('http://player.r7.com/video/i/%s' % video_id, R7IE.ie_key())\n", "comments": "(?x)\n                        https?://\n                        (?:\n                            (?:[a-zA-Z]+)\\.r7\\.com(?:/[^/]+)+/idmedia/|\n                            noticias\\.r7\\.com(?:/[^/]+)+/[^/]+-|\n                            player\\.r7\\.com/video/i/\n                        )\n                        (?P<id>[\\da-f]{24})\n                    \n \n# coding: utf-8\n# m3u8 format always matches the http format, let's copy metadata from\n# one to another\n#&]+-(?P<id>\\d+)'\n", "content": "# coding: utf-8\nfrom __future__ import unicode_literals\n\nfrom .common import InfoExtractor\nfrom ..utils import int_or_none\n\n\nclass R7IE(InfoExtractor):\n    _VALID_URL = r'''(?x)\n                        https?://\n                        (?:\n                            (?:[a-zA-Z]+)\\.r7\\.com(?:/[^/]+)+/idmedia/|\n                            noticias\\.r7\\.com(?:/[^/]+)+/[^/]+-|\n                            player\\.r7\\.com/video/i/\n                        )\n                        (?P<id>[\\da-f]{24})\n                    '''\n    _TESTS = [{\n        'url': 'http://videos.r7.com/policiais-humilham-suspeito-a-beira-da-morte-morre-com-dignidade-/idmedia/54e7050b0cf2ff57e0279389.html',\n        'md5': '403c4e393617e8e8ddc748978ee8efde',\n        'info_dict': {\n            'id': '54e7050b0cf2ff57e0279389',\n            'ext': 'mp4',\n            'title': 'Policiais humilham suspeito \u00e0 beira da morte: \"Morre com dignidade\"',\n            'description': 'md5:01812008664be76a6479aa58ec865b72',\n            'thumbnail': r're:^https?://.*\\.jpg$',\n            'duration': 98,\n            'like_count': int,\n            'view_count': int,\n        },\n    }, {\n        'url': 'http://esportes.r7.com/videos/cigano-manda-recado-aos-fas/idmedia/4e176727b51a048ee6646a1b.html',\n        'only_matching': True,\n    }, {\n        'url': 'http://noticias.r7.com/record-news/video/representante-do-instituto-sou-da-paz-fala-sobre-fim-do-estatuto-do-desarmamento-5480fc580cf2285b117f438d/',\n        'only_matching': True,\n    }, {\n        'url': 'http://player.r7.com/video/i/54e7050b0cf2ff57e0279389?play=true&video=http://vsh.r7.com/54e7050b0cf2ff57e0279389/ER7_RE_BG_MORTE_JOVENS_570kbps_2015-02-2009f17818-cc82-4c8f-86dc-89a66934e633-ATOS_copy.mp4&linkCallback=http://videos.r7.com/policiais-humilham-suspeito-a-beira-da-morte-morre-com-dignidade-/idmedia/54e7050b0cf2ff57e0279389.html&thumbnail=http://vtb.r7.com/ER7_RE_BG_MORTE_JOVENS_570kbps_2015-02-2009f17818-cc82-4c8f-86dc-89a66934e633-thumb.jpg&idCategory=192&share=true&layout=full&full=true',\n        'only_matching': True,\n    }]\n\n    def _real_extract(self, url):\n        video_id = self._match_id(url)\n\n        video = self._download_json(\n            'http://player-api.r7.com/video/i/%s' % video_id, video_id)\n\n        title = video['title']\n\n        formats = []\n        media_url_hls = video.get('media_url_hls')\n        if media_url_hls:\n            formats.extend(self._extract_m3u8_formats(\n                media_url_hls, video_id, 'mp4', entry_protocol='m3u8_native',\n                m3u8_id='hls', fatal=False))\n        media_url = video.get('media_url')\n        if media_url:\n            f = {\n                'url': media_url,\n                'format_id': 'http',\n            }\n            # m3u8 format always matches the http format, let's copy metadata from\n            # one to another\n            m3u8_formats = list(filter(\n                lambda f: f.get('vcodec') != 'none', formats))\n            if len(m3u8_formats) == 1:\n                f_copy = m3u8_formats[0].copy()\n                f_copy.update(f)\n                f_copy['protocol'] = 'http'\n                f = f_copy\n            formats.append(f)\n        self._sort_formats(formats)\n\n        description = video.get('description')\n        thumbnail = video.get('thumb')\n        duration = int_or_none(video.get('media_duration'))\n        like_count = int_or_none(video.get('likes'))\n        view_count = int_or_none(video.get('views'))\n\n        return {\n            'id': video_id,\n            'title': title,\n            'description': description,\n            'thumbnail': thumbnail,\n            'duration': duration,\n            'like_count': like_count,\n            'view_count': view_count,\n            'formats': formats,\n        }\n\n\nclass R7ArticleIE(InfoExtractor):\n    _VALID_URL = r'https?://(?:[a-zA-Z]+)\\.r7\\.com/(?:[^/]+/)+[^/?#&]+-(?P<id>\\d+)'\n    _TEST = {\n        'url': 'http://tv.r7.com/record-play/balanco-geral/videos/policiais-humilham-suspeito-a-beira-da-morte-morre-com-dignidade-16102015',\n        'only_matching': True,\n    }\n\n    @classmethod\n    def suitable(cls, url):\n        return False if R7IE.suitable(url) else super(R7ArticleIE, cls).suitable(url)\n\n    def _real_extract(self, url):\n        display_id = self._match_id(url)\n\n        webpage = self._download_webpage(url, display_id)\n\n        video_id = self._search_regex(\n            r'<div[^>]+(?:id=[\"\\']player-|class=[\"\\']embed[\"\\'][^>]+id=[\"\\'])([\\da-f]{24})',\n            webpage, 'video id')\n\n        return self.url_result('http://player.r7.com/video/i/%s' % video_id, R7IE.ie_key())\n", "description": "Command-line program to download videos from YouTube.com and other video sites", "file_name": "r7.py", "language": "Python", "project_name": "youtube-dl", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/rg3_youtube-dl/rg3-youtube-dl-6202f08/youtube_dl/extractor/r7.py", "save_time": "", "source": "", "update_at": "2018-03-07T09:18:39Z", "url": "https://github.com/rg3/youtube-dl", "wiki": false}