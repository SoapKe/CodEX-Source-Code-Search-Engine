{"author": "odoo", "code": "# -*- coding: utf-8 -*-\n\n\nfrom odoo.addons.website_form.controllers.main import WebsiteForm\nfrom odoo.http import request, route\n\n\nclass WebsiteForm(WebsiteForm):\n\n    def _get_country(self):\n        country_code = request.session.geoip and request.session.geoip.get('country_code') or False\n        if country_code:\n            return request.env['res.country'].sudo().search([('code', '=', country_code)], limit=1)\n        return request.env['res.country']\n\n    def _get_phone_fields_to_validate(self):\n        return ['phone', 'mobile']\n\n    @route('/website_form/<string:model_name>', type='http', auth=\"public\", methods=['POST'], website=True)\n    def website_form(self, model_name, **kwargs):\n        model_record = request.env['ir.model'].sudo().search([('model', '=', model_name), ('website_form_access', '=', True)])\n        if not model_record or not hasattr(request.env[model_name], 'phone_format'):\n            return super(WebsiteForm, self).website_form(model_name, **kwargs)\n\n        try:\n            data = self.extract_data(model_record, request.params)\n        except:\n            \n            pass\n        else:\n            record = data.get('record', {})\n            phone_fields = self._get_phone_fields_to_validate()\n            country = request.env['res.country'].browse(record.get('country_id'))\n            contact_country = country.exists() and country or self._get_country()\n            for phone_field in phone_fields:\n                if not record.get(phone_field):\n                    continue\n                number = record[phone_field]\n                fmt_number = request.env[model_name].phone_format(number, contact_country)\n                request.params.update({phone_field: fmt_number})\n\n        return super(WebsiteForm, self).website_form(model_name, **kwargs)\n", "comments": "      coding  utf 8        part odoo  see license file full copyright licensing details     specific management  super ", "content": "# -*- coding: utf-8 -*-\n# Part of Odoo. See LICENSE file for full copyright and licensing details.\n\nfrom odoo.addons.website_form.controllers.main import WebsiteForm\nfrom odoo.http import request, route\n\n\nclass WebsiteForm(WebsiteForm):\n\n    def _get_country(self):\n        country_code = request.session.geoip and request.session.geoip.get('country_code') or False\n        if country_code:\n            return request.env['res.country'].sudo().search([('code', '=', country_code)], limit=1)\n        return request.env['res.country']\n\n    def _get_phone_fields_to_validate(self):\n        return ['phone', 'mobile']\n\n    @route('/website_form/<string:model_name>', type='http', auth=\"public\", methods=['POST'], website=True)\n    def website_form(self, model_name, **kwargs):\n        model_record = request.env['ir.model'].sudo().search([('model', '=', model_name), ('website_form_access', '=', True)])\n        if not model_record or not hasattr(request.env[model_name], 'phone_format'):\n            return super(WebsiteForm, self).website_form(model_name, **kwargs)\n\n        try:\n            data = self.extract_data(model_record, request.params)\n        except:\n            # no specific management, super will do it\n            pass\n        else:\n            record = data.get('record', {})\n            phone_fields = self._get_phone_fields_to_validate()\n            country = request.env['res.country'].browse(record.get('country_id'))\n            contact_country = country.exists() and country or self._get_country()\n            for phone_field in phone_fields:\n                if not record.get(phone_field):\n                    continue\n                number = record[phone_field]\n                fmt_number = request.env[model_name].phone_format(number, contact_country)\n                request.params.update({phone_field: fmt_number})\n\n        return super(WebsiteForm, self).website_form(model_name, **kwargs)\n", "description": "Odoo. Open Source Apps To Grow Your Business.", "file_name": "website_form.py", "id": "95075eaa34f28757d5897406809e3cb6", "language": "Python", "project_name": "odoo", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/odoo-odoo/odoo-odoo-b25250f/addons/website_crm_phone_validation/controllers/website_form.py", "save_time": "", "source": "", "update_at": "2018-03-18T08:30:22Z", "url": "https://github.com/odoo/odoo", "wiki": true}