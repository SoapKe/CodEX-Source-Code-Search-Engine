{"author": "nvbn", "code": "import os\nimport pytest\nfrom thefuck.rules.ssh_known_hosts import match, get_new_command,\\\n    side_effect\nfrom thefuck.types import Command\n\n\n@pytest.fixture\ndef ssh_error(tmpdir):\n    path = os.path.join(str(tmpdir), 'known_hosts')\n\n    def reset(path):\n        with open(path, 'w') as fh:\n            lines = [\n                '123.234.567.890 asdjkasjdakjsd\\n'\n                '98.765.432.321 ejioweojwejrosj\\n'\n                '111.222.333.444 qwepoiwqepoiss\\n'\n            ]\n            fh.writelines(lines)\n\n    def known_hosts(path):\n        with open(path, 'r') as fh:\n            return fh.readlines()\n\n    reset(path)\n\n    errormsg = u.format(path, '98.765.432.321')\n\n    return errormsg, path, reset, known_hosts\n\n\ndef test_match(ssh_error):\n    errormsg, _, _, _ = ssh_error\n    assert match(Command('ssh', errormsg))\n    assert match(Command('ssh', errormsg))\n    assert match(Command('scp something something', errormsg))\n    assert match(Command('scp something something', errormsg))\n    assert not match(Command(errormsg, ''))\n    assert not match(Command('notssh', errormsg))\n    assert not match(Command('ssh', ''))\n\n\n@pytest.mark.skipif(os.name == 'nt', reason='Skip if testing on Windows')\ndef test_side_effect(ssh_error):\n    errormsg, path, reset, known_hosts = ssh_error\n    command = Command('ssh user@host', errormsg)\n    side_effect(command, None)\n    expected = ['123.234.567.890 asdjkasjdakjsd\\n', '111.222.333.444 qwepoiwqepoiss\\n']\n    assert known_hosts(path) == expected\n\n\ndef test_get_new_command(ssh_error, monkeypatch):\n    errormsg, _, _, _ = ssh_error\n    assert get_new_command(Command('ssh user@host', errormsg)) == 'ssh user@host'\n", "comments": "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\nSomeone could be eavesdropping on you right now (man-in-the-middle attack)!\nIt is also possible that a host key has just been changed.\nThe fingerprint for the RSA key sent by the remote host is\nb6:cb:07:34:c0:a0:94:d3:0d:69:83:31:f4:c5:20:9b.\nPlease contact your system administrator.\nAdd correct host key in {0} to get rid of this message.\nOffending RSA key in {0}:2\nRSA host key for {1} has changed and you have requested strict checking.\nHost key verification failed.\n.\n", "content": "import os\nimport pytest\nfrom thefuck.rules.ssh_known_hosts import match, get_new_command,\\\n    side_effect\nfrom thefuck.types import Command\n\n\n@pytest.fixture\ndef ssh_error(tmpdir):\n    path = os.path.join(str(tmpdir), 'known_hosts')\n\n    def reset(path):\n        with open(path, 'w') as fh:\n            lines = [\n                '123.234.567.890 asdjkasjdakjsd\\n'\n                '98.765.432.321 ejioweojwejrosj\\n'\n                '111.222.333.444 qwepoiwqepoiss\\n'\n            ]\n            fh.writelines(lines)\n\n    def known_hosts(path):\n        with open(path, 'r') as fh:\n            return fh.readlines()\n\n    reset(path)\n\n    errormsg = u\"\"\"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\nSomeone could be eavesdropping on you right now (man-in-the-middle attack)!\nIt is also possible that a host key has just been changed.\nThe fingerprint for the RSA key sent by the remote host is\nb6:cb:07:34:c0:a0:94:d3:0d:69:83:31:f4:c5:20:9b.\nPlease contact your system administrator.\nAdd correct host key in {0} to get rid of this message.\nOffending RSA key in {0}:2\nRSA host key for {1} has changed and you have requested strict checking.\nHost key verification failed.\"\"\".format(path, '98.765.432.321')\n\n    return errormsg, path, reset, known_hosts\n\n\ndef test_match(ssh_error):\n    errormsg, _, _, _ = ssh_error\n    assert match(Command('ssh', errormsg))\n    assert match(Command('ssh', errormsg))\n    assert match(Command('scp something something', errormsg))\n    assert match(Command('scp something something', errormsg))\n    assert not match(Command(errormsg, ''))\n    assert not match(Command('notssh', errormsg))\n    assert not match(Command('ssh', ''))\n\n\n@pytest.mark.skipif(os.name == 'nt', reason='Skip if testing on Windows')\ndef test_side_effect(ssh_error):\n    errormsg, path, reset, known_hosts = ssh_error\n    command = Command('ssh user@host', errormsg)\n    side_effect(command, None)\n    expected = ['123.234.567.890 asdjkasjdakjsd\\n', '111.222.333.444 qwepoiwqepoiss\\n']\n    assert known_hosts(path) == expected\n\n\ndef test_get_new_command(ssh_error, monkeypatch):\n    errormsg, _, _, _ = ssh_error\n    assert get_new_command(Command('ssh user@host', errormsg)) == 'ssh user@host'\n", "description": "Magnificent app which corrects your previous console command.", "file_name": "test_ssh_known_host.py", "language": "Python", "project_name": "thefuck", "quality": "", "save_path": "/home/ubuntu/test_files/clean/python/nvbn_thefuck/nvbn-thefuck-284d49d/tests/rules/test_ssh_known_host.py", "save_time": "", "source": "", "update_at": "2018-03-07T09:34:29Z", "url": "https://github.com/nvbn/thefuck", "wiki": true}